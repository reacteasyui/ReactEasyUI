!function(window,undefined){function _isArray(a){return a?"[object Array]"===Object.prototype.toString.call(a):!1}function _isFunction(a){return a?"[object Function]"===Object.prototype.toString.call(a):!1}function _inArray(a,b){for(var c=0,d=b.length;d>c;c++)if(a===b[c])return c;return-1}function _each(a,b){var c,d,e;if(_isArray(a))for(c=0,d=a.length;d>c&&b.call(a[c],c,a[c])!==!1;c++);else for(e in a)if(a.hasOwnProperty(e)&&b.call(a[e],e,a[e])===!1)break}function _trim(a){return a.replace(/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"")}function _inString(a,b,c){return c=c===undefined?",":c,(c+b+c).indexOf(c+a+c)>=0}function _addUnit(a,b){return b=b||"px",a&&/^\d+$/.test(a)?a+b:a}function _removeUnit(a){var b;return a&&(b=/(\d+)/.exec(a))?parseInt(b[1],10):0}function _escape(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function _unescape(a){return a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}function _toCamel(a){var b=a.split("-");return a="",_each(b,function(b,c){a+=b>0?c.charAt(0).toUpperCase()+c.substr(1):c}),a}function _toHex(a){function b(a){var b=parseInt(a,10).toString(16).toUpperCase();return b.length>1?b:"0"+b}return a.replace(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/gi,function(a,c,d,e){return"#"+b(c)+b(d)+b(e)})}function _toMap(a,b){b=b===undefined?",":b;var e,c={},d=_isArray(a)?a:a.split(b);return _each(d,function(a,b){if(e=/^(\d+)\.\.(\d+)$/.exec(b))for(var d=parseInt(e[1],10);d<=parseInt(e[2],10);d++)c[d.toString()]=!0;else c[b]=!0}),c}function _toArray(a,b){return Array.prototype.slice.call(a,b||0)}function _undef(a,b){return a===undefined?b:a}function _invalidUrl(a){return!a||/[<>"]/.test(a)}function _addParam(a,b){return a.indexOf("?")>=0?a+"&"+b:a+"?"+b}function _extend(a,b,c){var d,e;c||(c=b,b=null),b?(e=function(){},e.prototype=b.prototype,d=new e,_each(c,function(a,b){d[a]=b})):d=c,d.constructor=a,a.prototype=d,a.parent=b?b.prototype:null}function _json(text){var match,cx;if((match=/\{[\s\S]*\}|\[[\s\S]*\]/.exec(text))&&(text=match[0]),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return eval("("+text+")");throw"JSON parse error"}function _getBasePath(){var b,c,d,a=document.getElementsByTagName("script");for(c=0,d=a.length;d>c;c++)if(b=a[c].src||"",/kindeditor[\w\-\.]*\.js/.test(b))return b.substring(0,b.lastIndexOf("/")+1);return""}function _bindEvent(a,b,c){a.addEventListener?a.addEventListener(b,c,_useCapture):a.attachEvent&&a.attachEvent("on"+b,c)}function _unbindEvent(a,b,c){a.removeEventListener?a.removeEventListener(b,c,_useCapture):a.detachEvent&&a.detachEvent("on"+b,c)}function KEvent(a,b){this.init(a,b)}function _getId(a){return a[_eventExpendo]||null}function _setId(a){return a[_eventExpendo]=++_eventId,_eventId}function _removeId(a){try{delete a[_eventExpendo]}catch(b){a.removeAttribute&&a.removeAttribute(_eventExpendo)}}function _bind(a,b,c){var d,e;return b.indexOf(",")>=0?(_each(b.split(","),function(){_bind(a,this,c)}),void 0):(d=_getId(a),d||(d=_setId(a)),_eventData[d]===undefined&&(_eventData[d]={}),e=_eventData[d][b],e&&e.length>0?_unbindEvent(a,b,e[0]):(_eventData[d][b]=[],_eventData[d].el=a),e=_eventData[d][b],0===e.length&&(e[0]=function(b){var c=b?new KEvent(a,b):undefined;_each(e,function(b,d){b>0&&d&&d.call(a,c)})}),_inArray(c,e)<0&&e.push(c),_bindEvent(a,b,e[0]),void 0)}function _unbind(a,b,c){var d,e,f;return b&&b.indexOf(",")>=0?(_each(b.split(","),function(){_unbind(a,this,c)}),void 0):(d=_getId(a))?b===undefined?(d in _eventData&&(_each(_eventData[d],function(b,c){"el"!=b&&c.length>0&&_unbindEvent(a,b,c[0])}),delete _eventData[d],_removeId(a)),void 0):(_eventData[d]&&(e=_eventData[d][b],e&&e.length>0&&(c===undefined?(_unbindEvent(a,b,e[0]),delete _eventData[d][b]):(_each(e,function(a,b){a>0&&b===c&&e.splice(a,1)}),1==e.length&&(_unbindEvent(a,b,e[0]),delete _eventData[d][b])),f=0,_each(_eventData[d],function(){f++}),2>f&&(delete _eventData[d],_removeId(a)))),void 0):void 0}function _fire(a,b){var c,d;return b.indexOf(",")>=0?(_each(b.split(","),function(){_fire(a,this)}),void 0):(c=_getId(a),c&&(d=_eventData[c][b],_eventData[c]&&d&&d.length>0&&d[0]()),void 0)}function _ctrl(a,b,c){b=/^\d{2,}$/.test(b)?b:b.toUpperCase().charCodeAt(0),_bind(a,"keydown",function(d){!d.ctrlKey||d.which!=b||d.shiftKey||d.altKey||(c.call(a),d.stop())})}function _ready(a){function c(){b||(b=!0,a(KindEditor),_readyFinished=!0)}function d(){if(!b){try{document.documentElement.doScroll("left")}catch(a){return setTimeout(d,100),void 0}c()}}function e(){"complete"===document.readyState&&c()}var b,f;if(_readyFinished)return a(KindEditor),void 0;if(b=!1,document.addEventListener)_bind(document,"DOMContentLoaded",c);else if(document.attachEvent){_bind(document,"readystatechange",e),f=!1;try{f=null==window.frameElement}catch(g){}document.documentElement.doScroll&&f&&d()}_bind(window,"load",c)}function _getCssList(a){for(var d,e,f,b={},c=/\s*([\w\-]+)\s*:([^;]*)(;|$)/g;d=c.exec(a);)e=_trim(d[1].toLowerCase()),f=_trim(_toHex(d[2])),b[e]=f;return b}function _getAttrList(a){for(var d,e,f,b={},c=/\s+(?:([\w\-:]+)|(?:([\w\-:]+)=([^\s"'<>]+))|(?:([\w\-:"]+)="([^"]*)")|(?:([\w\-:"]+)='([^']*)'))(?=(?:\s|\/|>)+)/g;d=c.exec(a);)e=(d[1]||d[2]||d[4]||d[6]).toLowerCase(),f=(d[2]?d[3]:d[4]?d[5]:d[7])||"",b[e]=f;return b}function _addClassToTag(a,b){return a=/\s+class\s*=/.test(a)?a.replace(/(\s+class=["']?)([^"']*)(["']?[\s>])/,function(a,c,d,e){return(" "+d+" ").indexOf(" "+b+" ")<0?""===d?c+b+e:c+d+" "+b+e:a}):a.substr(0,a.length-1)+' class="'+b+'">'}function _formatCss(a){var b="";return _each(_getCssList(a),function(a,c){b+=a+":"+c+";"}),b}function _formatUrl(a,b,c,d){function g(a){var d,e,f,b=a.split("/"),c=[];for(d=0,e=b.length;e>d;d++)f=b[d],".."==f?c.length>0&&c.pop():""!==f&&"."!=f&&c.push(f);return"/"+c.join("/")}function h(b,c){var e,g,i;if(a.substr(0,b.length)===b){for(e=[],g=0;c>g;g++)e.push("..");return i=".",e.length>0&&(i+="/"+e.join("/")),"/"==d&&(i+="/"),i+a.substr(b.length)}return(f=/^(.*)\//.exec(b))?h(f[1],++c):void 0}var e,f;if(b=_undef(b,"").toLowerCase(),"data:"!=a.substr(0,5)&&(a=a.replace(/([^:])\/\//g,"$1/")),_inArray(b,["absolute","relative","domain"])<0)return a;if(c=c||location.protocol+"//"+location.host,d===undefined&&(e=location.pathname.match(/^(\/.*)\//),d=e?e[1]:""),f=/^(\w+:\/\/[^\/]*)/.exec(a)){if(f[1]!==c)return a}else if(/^\w+:/.test(a))return a;return/^\//.test(a)?a=c+g(a.substr(1)):/^\w+:\/\//.test(a)||(a=c+g(d+"/"+a)),"relative"===b?a=h(c+d,0).substr(2):"absolute"===b&&a.substr(0,c.length)===c&&(a=a.substr(c.length)),a}function _formatHtml(a,b,c,d,e){var f,g,h,i;return null==a&&(a=""),c=c||"",d=_undef(d,!1),e=_undef(e,"	"),f="xx-small,x-small,small,medium,large,x-large,xx-large".split(","),a=a.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/gi,function(a,b,c,d){return b+c.replace(/<(?:br|br\s[^>]*)>/gi,"\n")+d}),a=a.replace(/<(?:br|br\s[^>]*)\s*\/?>\s*<\/p>/gi,"</p>"),a=a.replace(/(<(?:p|p\s[^>]*)>)\s*(<\/p>)/gi,"$1<br />$2"),a=a.replace(/\u200B/g,""),a=a.replace(/\u00A9/g,"&copy;"),a=a.replace(/\u00AE/g,"&reg;"),a=a.replace(/<[^>]+/g,function(a){return a.replace(/\s+/g," ")}),g={},b&&(_each(b,function(a,b){var d,e,c=a.split(",");for(d=0,e=c.length;e>d;d++)g[c[d]]=_toMap(b)}),g.script||(a=a.replace(/(<(?:script|script\s[^>]*)>)([\s\S]*?)(<\/script>)/gi,"")),g.style||(a=a.replace(/(<(?:style|style\s[^>]*)>)([\s\S]*?)(<\/style>)/gi,""))),h=/(\s*)<(\/)?([\w\-:]+)((?:\s+|(?:\s+[\w\-:]+)|(?:\s+[\w\-:]+=[^\s"'<>]+)|(?:\s+[\w\-:"]+="[^"]*")|(?:\s+[\w\-:"]+='[^']*'))*)(\/)?>(\s*)/g,i=[],a=a.replace(h,function(a,h,j,k,l,m,n){var v,w,x,y,z,o=a,p=h||"",q=j||"",r=k.toLowerCase(),s=l||"",t=m?" "+m:"",u=n||"";if(b&&!g[r])return"";if(""===t&&_SINGLE_TAG_MAP[r]&&(t=" /"),_INLINE_TAG_MAP[r]&&(p&&(p=" "),u&&(u=" ")),_PRE_TAG_MAP[r]&&(q?u="\n":p="\n"),d&&"br"==r&&(u="\n"),_BLOCK_TAG_MAP[r]&&!_PRE_TAG_MAP[r])if(d){for(q&&i.length>0&&i[i.length-1]===r?i.pop():i.push(r),p="\n",u="\n",v=0,w=q?i.length:i.length-1;w>v;v++)p+=e,q||(u+=e);t?i.pop():q||(u+=e)}else p=u="";return""!==s&&(x=_getAttrList(o),"font"===r&&(y={},z="",_each(x,function(a,b){"color"===a&&(y.color=b,delete x[a]),"size"===a&&(y["font-size"]=f[parseInt(b,10)-1]||"",delete x[a]),"face"===a&&(y["font-family"]=b,delete x[a]),"style"===a&&(z=b)}),z&&!/;$/.test(z)&&(z+=";"),_each(y,function(a,b){""!==b&&(/\s/.test(b)&&(b="'"+b+"'"),z+=a+":"+b+";")}),x.style=z),_each(x,function(a,d){var e,f;_FILL_ATTR_MAP[a]&&(x[a]=a),_inArray(a,["src","href"])>=0&&(x[a]=_formatUrl(d,c)),(b&&"style"!==a&&!g[r]["*"]&&!g[r][a]||"body"===r&&"contenteditable"===a||/^kindeditor_\d+$/.test(a))&&delete x[a],"style"===a&&""!==d&&(e=_getCssList(d),_each(e,function(a){!b||g[r].style||g[r]["."+a]||delete e[a]}),f="",_each(e,function(a,b){f+=a+":"+b+";"}),x.style=f)}),s="",_each(x,function(a,b){("style"!==a||""!==b)&&(b=b.replace(/"/g,"&quot;"),s+=" "+a+'="'+b+'"')})),"font"===r&&(r="span"),p+"<"+q+r+s+t+">"+u}),a=a.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/gi,function(a,b,c,d){return b+c.replace(/\n/g,'<span id="__kindeditor_pre_newline__">\n')+d}),a=a.replace(/\n\s*\n/g,"\n"),a=a.replace(/<span id="__kindeditor_pre_newline__">\n/g,"\n"),_trim(a)}function _clearMsWord(a,b){return a=a.replace(/<meta[\s\S]*?>/gi,"").replace(/<![\s\S]*?>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<w:[^>]+>[\s\S]*?<\/w:[^>]+>/gi,"").replace(/<o:[^>]+>[\s\S]*?<\/o:[^>]+>/gi,"").replace(/<xml>[\s\S]*?<\/xml>/gi,"").replace(/<(?:table|td)[^>]*>/gi,function(a){return a.replace(/border-bottom:([#\w\s]+)/gi,"border:$1")}),_formatHtml(a,b)}function _mediaType(a){return/\.(rm|rmvb)(\?|$)/i.test(a)?"audio/x-pn-realaudio-plugin":/\.(swf|flv)(\?|$)/i.test(a)?"application/x-shockwave-flash":"video/x-ms-asf-plugin"}function _mediaClass(a){return/realaudio/i.test(a)?"ke-rm":/flash/i.test(a)?"ke-flash":"ke-media"}function _mediaAttrs(a){return _getAttrList(unescape(a))}function _mediaEmbed(a){var b="<embed ";return _each(a,function(a,c){b+=a+'="'+c+'" '}),b+="/>"}function _mediaImg(a,b){var h,c=b.width,d=b.height,e=b.type||_mediaType(b.src),f=_mediaEmbed(b),g="";return/\D/.test(c)?g+="width:"+c+";":c>0&&(g+="width:"+c+"px;"),/\D/.test(d)?g+="height:"+d+";":d>0&&(g+="height:"+d+"px;"),h='<img class="'+_mediaClass(e)+'" src="'+a+'" ',""!==g&&(h+='style="'+g+'" '),h+='data-ke-tag="'+escape(f)+'" alt="" />'}function _tmpl(a,b){var c=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return b?c(b):c}function _contains(a,b){if(9==a.nodeType&&9!=b.nodeType)return!0;for(;b=b.parentNode;)if(b==a)return!0;return!1}function _getAttr(a,b){var c,d,e;if(b=b.toLowerCase(),c=null,_GET_SET_ATTRIBUTE||"script"==a.nodeName.toLowerCase())try{c=a.getAttribute(b,2)}catch(f){c=a.getAttribute(b,1)}else d=a.ownerDocument.createElement("div"),d.appendChild(a.cloneNode(!1)),e=_getAttrList(_unescape(d.innerHTML)),b in e&&(c=e[b]);return"style"===b&&null!==c&&(c=_formatCss(c)),c}function _queryAll(a,b){function e(a){return"string"!=typeof a?a:a.replace(/([^\w\-])/g,"\\$1")}function f(a){return a.replace(/\\/g,"")}function g(a,b){return"*"===a||a.toLowerCase()===e(b.toLowerCase())}function h(a,b,c){var d=[],e=c.ownerDocument||c,h=e.getElementById(f(a));return h&&g(b,h.nodeName)&&_contains(c,h)&&d.push(h),d}function i(a,b,c){var h,i,j,k,l,d=c.ownerDocument||c,e=[];if(c.getElementsByClassName)for(h=c.getElementsByClassName(f(a)),i=0,j=h.length;j>i;i++)k=h[i],g(b,k.nodeName)&&e.push(k);else if(d.querySelectorAll)for(h=d.querySelectorAll(("#document"!==c.nodeName?c.nodeName+" ":"")+b+"."+a),i=0,j=h.length;j>i;i++)k=h[i],_contains(c,k)&&e.push(k);else for(h=c.getElementsByTagName(b),a=" "+a+" ",i=0,j=h.length;j>i;i++)k=h[i],1==k.nodeType&&(l=k.className,l&&(" "+l+" ").indexOf(a)>-1&&e.push(k));return e}function j(a,b,c){var i,j,k,d=[],e=c.ownerDocument||c,h=e.getElementsByName(f(a));for(j=0,k=h.length;k>j;j++)i=h[j],g(b,i.nodeName)&&_contains(c,i)&&null!==i.getAttribute("name")&&d.push(i);return d}function k(a,b,c,d){var h,i,j,f=[],g=d.getElementsByTagName(c);for(i=0,j=g.length;j>i;i++)h=g[i],1==h.nodeType&&(null===b?null!==_getAttr(h,a)&&f.push(h):b===e(_getAttr(h,a))&&f.push(h));return f}function l(a,b){var f,g,m,l,n,o,c=[],d=/^((?:\\.|[^.#\s\[<>])+)/.exec(a),e=d?d[1]:"*";if(d=/#((?:[\w\-]|\\.)+)$/.exec(a))c=h(d[1],e,b);else if(d=/\.((?:[\w\-]|\\.)+)$/.exec(a))c=i(d[1],e,b);else if(d=/\[((?:[\w\-]|\\.)+)\]/.exec(a))c=k(d[1].toLowerCase(),null,e,b);else if(d=/\[((?:[\w\-]|\\.)+)\s*=\s*['"]?((?:\\.|[^'"]+)+)['"]?\]/.exec(a))f=d[1].toLowerCase(),g=d[2],c="id"===f?h(g,e,b):"class"===f?i(g,e,b):"name"===f?j(g,e,b):k(f,g,e,b);else for(l=b.getElementsByTagName(e),n=0,o=l.length;o>n;n++)m=l[n],1==m.nodeType&&c.push(m);return c}var d,n,m,o,p,r,s,t,u,v,w,x,y,z,A,B,q,c=a.split(",");if(c.length>1)return d=[],_each(c,function(){_each(_queryAll(this,b),function(){_inArray(this,d)<0&&d.push(this)})}),d;for(b=b||document,m=[],o=/((?:\\.|[^\s>])+|[\s>])/g;n=o.exec(a);)" "!==n[1]&&m.push(n[1]);if(p=[],1==m.length)return l(m[0],b);for(q=!1,w=0,z=m.length;z>w;w++)if(r=m[w],">"!==r){if(w>0){for(s=[],x=0,A=p.length;A>x;x++)for(u=p[x],t=l(r,u),y=0,B=t.length;B>y;y++)v=t[y],q?u===v.parentNode&&s.push(v):s.push(v);p=s}else p=l(r,b);if(0===p.length)return[]}else q=!0;return p}function _query(a,b){var c=_queryAll(a,b);return c.length>0?c[0]:null}function _get(a){return K(a)[0]}function _getDoc(a){return a?a.ownerDocument||a.document||a:document}function _getWin(a){if(!a)return window;var b=_getDoc(a);return b.parentWindow||b.defaultView}function _setHtml(a,b){var c,d;if(1==a.nodeType){c=_getDoc(a);try{a.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+b,d=c.getElementById("__kindeditor_temp_tag__"),d.parentNode.removeChild(d)}catch(e){K(a).empty(),K("@"+b,c).each(function(){a.appendChild(this)})}}}function _hasClass(a,b){return _inString(b,a.className," ")}function _setAttr(a,b,c){_IE&&8>_V&&"class"==b.toLowerCase()&&(b="className"),a.setAttribute(b,""+c)}function _removeAttr(a,b){_IE&&8>_V&&"class"==b.toLowerCase()&&(b="className"),_setAttr(a,b,""),a.removeAttribute(b)}function _getNodeName(a){return a&&a.nodeName?a.nodeName.toLowerCase():""}function _computedCss(a,b){var g,d=_getWin(a),e=_toCamel(b),f="";return d.getComputedStyle?(g=d.getComputedStyle(a,null),f=g[e]||g.getPropertyValue(b)||a.style[e]):a.currentStyle&&(f=a.currentStyle[e]||a.style[e]),f}function _hasVal(a){return!!_VALUE_TAG_MAP[_getNodeName(a)]}function _docElement(a){return a=a||document,_QUIRKS?a.body:a.documentElement}function _docHeight(a){var b=_docElement(a);return Math.max(b.scrollHeight,b.clientHeight)}function _docWidth(a){var b=_docElement(a);return Math.max(b.scrollWidth,b.clientWidth)}function _getScrollPos(a){a=a||document;var b,c;return _IE||_NEWIE||_OPERA?(b=_docElement(a).scrollLeft,c=_docElement(a).scrollTop):(b=_getWin(a).scrollX,c=_getWin(a).scrollY),{x:b,y:c}}function KNode(a){this.init(a)}function _updateCollapsed(a){return a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a}function _copyAndDelete(a,b,c){function f(d,f,g){var i,j,k,l,h=d.nodeValue.length;return b&&(j=d.cloneNode(!0),i=f>0?j.splitText(f):j,h>g&&i.splitText(g-f)),c&&(k=d,f>0&&(k=d.splitText(f),a.setStart(d,f)),h>g&&(l=k.splitText(g-f),a.setEnd(l,0)),e.push(k)),i}function g(){var b,d,f;for(c&&a.up().collapse(!0),b=0,d=e.length;d>b;b++)f=e[b],f.parentNode&&f.parentNode.removeChild(f)}function p(g,m){for(var o,q,r,s,n=g.firstChild;n;){if(q=new KRange(d).selectNode(n),i=q.compareBoundaryPoints(_START_TO_END,a),i>=0&&0>=j&&(j=q.compareBoundaryPoints(_START_TO_START,a)),j>=0&&0>=k&&(k=q.compareBoundaryPoints(_END_TO_END,a)),k>=0&&0>=l&&(l=q.compareBoundaryPoints(_END_TO_START,a)),l>=0)return!1;if(o=n.nextSibling,i>0)if(1==n.nodeType){if(j>=0&&0>=k)b&&m.appendChild(n.cloneNode(!0)),c&&e.push(n);else if(b&&(r=n.cloneNode(!1),m.appendChild(r)),p(n,r)===!1)return!1}else if(3==n.nodeType&&(s=n==h.startContainer?f(n,h.startOffset,n.nodeValue.length):n==h.endContainer?f(n,0,h.endOffset):f(n,0,n.nodeValue.length),b))try{m.appendChild(s)}catch(t){}n=o}}var o,q,r,s,d=a.doc,e=[],h=a.cloneRange().down(),i=-1,j=-1,k=-1,l=-1,m=a.commonAncestor(),n=d.createDocumentFragment();if(3==m.nodeType)return o=f(m,a.startOffset,a.endOffset),b&&n.appendChild(o),g(),b?n:a;for(p(m,n),c&&a.up().collapse(!0),q=0,r=e.length;r>q;q++)s=e[q],s.parentNode&&s.parentNode.removeChild(s);return b?n:a}function _moveToElementText(a,b){for(var d,c=b;c;){if(d=K(c),"marquee"==d.name||"select"==d.name)return;c=c.parentNode}try{a.moveToElementText(b)}catch(e){}}function _getStartEnd(a,b){var e,f,g,h,i,j,k,l,m,o,n,p,q,r,c=a.parentElement().ownerDocument,d=a.duplicate();if(d.collapse(b),e=d.parentElement(),f=e.childNodes,0===f.length)return{node:e.parentNode,offset:K(e).index()};for(g=c,h=0,i=-1,j=a.duplicate(),_moveToElementText(j,e),k=0,l=f.length;l>k;k++){if(m=f[k],i=j.compareEndPoints("StartToStart",d),0===i)return{node:m.parentNode,offset:k};1==m.nodeType?(n=a.duplicate(),p=K(m),q=m,p.isControl()&&(o=c.createElement("span"),p.after(o),q=o,h+=p.text().replace(/\r\n|\n|\r/g,"").length),_moveToElementText(n,q),j.setEndPoint("StartToEnd",n),i>0?h+=n.text.replace(/\r\n|\n|\r/g,"").length:h=0,o&&K(o).remove()):3==m.nodeType&&(j.moveStart("character",m.nodeValue.length),h+=m.nodeValue.length),0>i&&(g=m)}if(0>i&&1==g.nodeType)return{node:e,offset:K(e.lastChild).index()+1};if(i>0)for(;g.nextSibling&&1==g.nodeType;)g=g.nextSibling;if(j=a.duplicate(),_moveToElementText(j,e),j.setEndPoint("StartToEnd",d),h-=j.text.replace(/\r\n|\n|\r/g,"").length,i>0&&3==g.nodeType)for(r=g.previousSibling;r&&3==r.nodeType;)h-=r.nodeValue.length,r=r.previousSibling;return{node:g,offset:h}}function _getEndRange(a,b){var f,g,e,i,h,j,c=a.ownerDocument||a,d=c.body.createTextRange();if(c==a)return d.collapse(!0),d;if(1==a.nodeType&&a.childNodes.length>0){if(e=a.childNodes,0===b?(g=e[0],f=!0):(g=e[b-1],f=!1),!g)return d;if("head"===K(g).name)return 1===b&&(f=!0),2===b&&(f=!1),d.collapse(f),d;if(1==g.nodeType)return h=K(g),h.isControl()&&(i=c.createElement("span"),f?h.before(i):h.after(i),g=i),_moveToElementText(d,g),d.collapse(f),i&&K(i).remove(),d;a=g,b=f?0:g.nodeValue.length}return j=c.createElement("span"),K(a).before(j),_moveToElementText(d,j),d.moveStart("character",b),K(j).remove(),d}function _toRange(a){function d(a){"tr"==K(a.node).name&&(a.node=a.node.cells[a.offset],a.offset=0)}var b,c,e,f,g;return _IERANGE?a.item?(b=_getDoc(a.item(0)),c=new KRange(b),c.selectNode(a.item(0)),c):(b=a.parentElement().ownerDocument,e=_getStartEnd(a,!0),f=_getStartEnd(a,!1),d(e),d(f),c=new KRange(b),c.setStart(e.node,e.offset),c.setEnd(f.node,f.offset),c):(g=a.startContainer,b=g.ownerDocument||g,c=new KRange(b),c.setStart(g,a.startOffset),c.setEnd(a.endContainer,a.endOffset),c)}function KRange(a){this.init(a)}function _range(a){return a.nodeName?new KRange(a):a.constructor===KRange?a:_toRange(a)}function _nativeCommand(a,b,c){try{a.execCommand(b,!1,c)}catch(d){}}function _nativeCommandValue(a,b){var c="";try{c=a.queryCommandValue(b)}catch(d){}return"string"!=typeof c&&(c=""),c}function _getSel(a){var b=_getWin(a);return _IERANGE?a.selection:b.getSelection()}function _getRng(a){var c,b=_getSel(a);try{c=b.rangeCount>0?b.getRangeAt(0):b.createRange()}catch(d){}return!_IERANGE||c&&(c.item||c.parentElement().ownerDocument===a)?c:null}function _singleKeyMap(a){var c,d,b={};return _each(a,function(a,e){c=a.split(",");for(var f=0,g=c.length;g>f;f++)d=c[f],b[d]=e}),b}function _hasAttrOrCss(a,b){return _hasAttrOrCssByKey(a,b,"*")||_hasAttrOrCssByKey(a,b)}function _hasAttrOrCssByKey(a,b,c){var d,e,f,g,h,i,j,k;if(c=c||a.name,1!==a.type)return!1;if(d=_singleKeyMap(b),!d[c])return!1;for(e=d[c].split(","),f=0,g=e.length;g>f;f++){if(h=e[f],"*"===h)return!0;if(i=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(h),j=i[1]?"css":"attr",h=i[2],k=i[3]||"",""===k&&""!==a[j](h))return!0;if(""!==k&&a[j](h)===k)return!0}return!1}function _removeAttrOrCss(a,b){1==a.type&&(_removeAttrOrCssByKey(a,b,"*"),_removeAttrOrCssByKey(a,b))}function _removeAttrOrCssByKey(a,b,c){var d,e,f,g,h,i,j;if(c=c||a.name,1===a.type&&(d=_singleKeyMap(b),d[c])){for(e=d[c].split(","),f=!1,g=0,h=e.length;h>g;g++){if(i=e[g],"*"===i){f=!0;break}j=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(i),i=j[2],j[1]?(i=_toCamel(i),a[0].style[i]&&(a[0].style[i]="")):a.removeAttr(i)}f&&a.remove(!0)}}function _getInnerNode(a){for(var b=a;b.first();)b=b.first();return b}function _isEmptyNode(a){return 1!=a.type||a.isSingle()?!1:""===a.html().replace(/<[^>]+>/g,"")}function _mergeWrapper(a,b){a=a.clone(!0);for(var c=_getInnerNode(a),d=a,e=!1;b;){for(;d;)d.name===b.name&&(_mergeAttrs(d,b.attr(),b.css()),e=!0),d=d.first();e||c.append(b.clone(!1)),e=!1,b=b.first()}return a}function _wrapNode(a,b){var d,c,e;if(b=b.clone(!0),3==a.type)return _getInnerNode(b).append(a.clone(!1)),a.replaceWith(b),b;for(c=a;(d=a.first())&&1==d.children().length;)a=d;for(d=a.first(),e=a.doc.createDocumentFragment();d;)e.appendChild(d[0]),d=d.next();return b=_mergeWrapper(c,b),e.firstChild&&_getInnerNode(b).append(e),c.replaceWith(b),b}function _mergeAttrs(a,b,c){_each(b,function(b,c){"style"!==b&&a.attr(b,c)}),_each(c,function(b,c){a.css(b,c)})}function _inPreElement(a){for(;a&&"body"!=a.name;){if(_PRE_TAG_MAP[a.name]||"div"==a.name&&a.hasClass("ke-script"))return!0;a=a.parent()}return!1}function KCmd(a){this.init(a)}function _cmd(a){if(a.nodeName){var b=_getDoc(a);a=_range(b).selectNodeContents(b.body).collapse(!1)}return new KCmd(a)}function _drag(a){var b=a.moveEl,c=a.moveFn,d=a.clickEl||b,e=a.beforeDrag,f=a.iframeFix===undefined?!0:a.iframeFix,g=[document];f&&K("iframe").each(function(){var b,d,a=_formatUrl(this.src||"","absolute");if(!/^https?:\/\//.test(a)){try{b=_iframeDoc(this)}catch(c){}b&&(d=K(this).pos(),K(b).data("pos-x",d.x),K(b).data("pos-y",d.y),g.push(b))}}),d.mousedown(function(a){function n(a){var b,e,f;a.preventDefault(),b=K(_getDoc(a.target)),e=_round((b.data("pos-x")||0)+a.pageX-l),f=_round((b.data("pos-y")||0)+a.pageY-m),c.call(d,h,i,j,k,e,f)}function o(a){a.preventDefault()}function p(a){a.preventDefault(),K(g).unbind("mousemove",n).unbind("mouseup",p).unbind("selectstart",o),f.releaseCapture&&f.releaseCapture()}a.stopPropagation();var f=d.get(),h=_removeUnit(b.css("left")),i=_removeUnit(b.css("top")),j=b.width(),k=b.height(),l=a.pageX,m=a.pageY;e&&e(),K(g).mousemove(n).mouseup(p).bind("selectstart",o),f.setCapture&&f.setCapture()})}function KWidget(a){this.init(a)}function _widget(a){return new KWidget(a)}function _iframeDoc(a){return a=_get(a),a.contentDocument||a.contentWindow.document}function _getInitHtml(a,b,c,d){var e=[""===_direction?"<html>":'<html dir="'+_direction+'">','<head><meta charset="utf-8" /><title></title>',"<style>","html {margin:0;padding:0;}","body {margin:0;padding:5px;}",'body, td {font:12px/1.5 "sans serif",tahoma,verdana,helvetica;}',"body, p, div {word-wrapper: break-word;}","p {margin:5px 0;}","table {border-collapse:collapse;}","img {border:0;}","noscript {display:none;}","table.ke-zeroborder td {border:1px dotted #AAA;}","img.ke-flash {","	border:1px solid #AAA;","	background-image:url("+a+"common/flash.gif);","	background-position:center center;","	background-repeat:no-repeat;","	width:100px;","	height:100px;","}","img.ke-rm {","	border:1px solid #AAA;","	background-image:url("+a+"common/rm.gif);","	background-position:center center;","	background-repeat:no-repeat;","	width:100px;","	height:100px;","}","img.ke-media {","	border:1px solid #AAA;","	background-image:url("+a+"common/media.gif);","	background-position:center center;","	background-repeat:no-repeat;","	width:100px;","	height:100px;","}","img.ke-anchor {","	border:1px dashed #666;","	width:16px;","	height:16px;","}",".ke-script, .ke-noscript, .ke-display-none {","	display:none;","	font-size:0;","	width:0;","	height:0;","}",".ke-pagebreak {","	border:1px dotted #AAA;","	font-size:0;","	height:2px;","}","</style>"];return _isArray(c)||(c=[c]),_each(c,function(a,b){b&&e.push('<link href="'+b+'" rel="stylesheet" />')}),d&&e.push("<style>"+d+"</style>"),e.push("</head><body "+(b?'class="'+b+'"':"")+"></body></html>"),e.join("\n")}function _elementVal(a,b){if(a.hasVal()){if(b===undefined){var c=a.val();return c=c.replace(/(<(?:p|p\s[^>]*)>) *(<\/p>)/gi,"")}return a.val(b)}return a.html(b)}function KEdit(a){this.init(a)}function _edit(a){return new KEdit(a)}function _selectToolbar(a,b){var c=this,d=c.get(a);if(d){if(d.hasClass("ke-disabled"))return;b(d)}}function KToolbar(a){this.init(a)}function _toolbar(a){return new KToolbar(a)}function KMenu(a){this.init(a)}function _menu(a){return new KMenu(a)}function KColorPicker(a){this.init(a)}function _colorpicker(a){return new KColorPicker(a)}function KUploadButton(a){this.init(a)}function _uploadbutton(a){return new KUploadButton(a)}function _createButton(a){a=a||{};var b=a.name||"",c=K('<span class="ke-button-common ke-button-outer" title="'+b+'"></span>'),d=K('<input class="ke-button-common ke-button" type="button" value="'+b+'" />');return a.click&&d.click(a.click),c.append(d),c}function KDialog(a){this.init(a)}function _dialog(a){return new KDialog(a)}function _tabs(a){var g,b=_widget(a),c=b.remove,d=a.afterSelect,e=b.div,f=[];return e.addClass("ke-tabs").bind("contextmenu,mousedown,mousemove",function(a){a.preventDefault()}),g=K('<ul class="ke-tabs-ul ke-clearfix"></ul>'),e.append(g),b.add=function(a){var b=K('<li class="ke-tabs-li">'+a.title+"</li>");b.data("tab",a),f.push(b),g.append(b)},b.selectedIndex=0,b.select=function(a){b.selectedIndex=a,_each(f,function(c,d){d.unbind(),c===a?(d.addClass("ke-tabs-li-selected"),K(d.data("tab").panel).show("")):(d.removeClass("ke-tabs-li-selected").removeClass("ke-tabs-li-on").mouseover(function(){K(this).addClass("ke-tabs-li-on")}).mouseout(function(){K(this).removeClass("ke-tabs-li-on")}).click(function(){b.select(c)}),K(d.data("tab").panel).hide())}),d&&d.call(b,a)},b.remove=function(){_each(f,function(){this.remove()}),g.remove(),c.call(b)},b}function _loadScript(a,b){var c=document.getElementsByTagName("head")[0]||(_QUIRKS?document.body:document.documentElement),d=document.createElement("script");c.appendChild(d),d.src=a,d.charset="utf-8",d.onload=d.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState||(b&&b(),d.onload=d.onreadystatechange=null,c.removeChild(d))}}function _chopQuery(a){var b=a.indexOf("?");return b>0?a.substr(0,b):a}function _loadStyle(a){var f,g,b=document.getElementsByTagName("head")[0]||(_QUIRKS?document.body:document.documentElement),c=document.createElement("link"),d=_chopQuery(_formatUrl(a,"absolute")),e=K('link[rel="stylesheet"]',b);for(f=0,g=e.length;g>f;f++)if(_chopQuery(_formatUrl(e[f].href,"absolute"))===d)return;b.appendChild(c),c.href=a,c.rel="stylesheet"}function _ajax(a,b,c,d,e){var f,g;if(c=c||"GET",e=e||"json",f=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),f.open(c,a,!0),f.onreadystatechange=function(){if(4==f.readyState&&200==f.status&&b){var a=_trim(f.responseText);"json"==e&&(a=_json(a)),b(a)}},"POST"==c){g=[],_each(d,function(a,b){g.push(encodeURIComponent(a)+"="+encodeURIComponent(b))});try{f.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}catch(h){}f.send(g.join("&"))}else f.send(null)}function _plugin(a,b){return a===undefined?_plugins:b?(_plugins[a]=b,void 0):_plugins[a]}function _parseLangKey(a){var b,c="core";return(b=/^(\w+)\.(\w+)$/.exec(a))&&(c=b[1],a=b[2]),{ns:c,key:a}}function _lang(a,b){var c,d;return b=b===undefined?K.options.langType:b,"string"==typeof a?_language[b]?(c=a.length-1,"."===a.substr(c)?_language[b][a.substr(0,c)]:(d=_parseLangKey(a),_language[b][d.ns][d.key])):"no language":(_each(a,function(a,c){var d=_parseLangKey(a);_language[b]||(_language[b]={}),_language[b][d.ns]||(_language[b][d.ns]={}),_language[b][d.ns][d.key]=c}),void 0)}function _getImageFromRange(a,b){var c,d,e;if(!a.collapsed&&(a=a.cloneRange().up(),c=a.startContainer,d=a.startOffset,(_WEBKIT||a.isControl())&&(e=K(c.childNodes[d]),e&&"img"==e.name)))return b(e)?e:void 0}function _bindContextmenuEvent(){var a=this,b=a.edit.doc;K(b).contextmenu(function(b){var c,d,e,f,g,h,i;if(a.menu&&a.hideMenu(),!a.useContextmenu)return b.preventDefault(),void 0;if(0!==a._contextmenus.length){for(c=0,d=[],_each(a._contextmenus,function(){return"-"==this.title?(d.push(this),void 0):(this.cond&&this.cond()&&(d.push(this),this.width&&this.width>c&&(c=this.width)),void 0)});d.length>0&&"-"==d[0].title;)d.shift();for(;d.length>0&&"-"==d[d.length-1].title;)d.pop();e=null,_each(d,function(a){"-"==this.title&&"-"==e.title&&delete d[a],e=this}),d.length>0&&(b.preventDefault(),f=K(a.edit.iframe).pos(),g=_menu({x:f.x+b.clientX,y:f.y+b.clientY,width:c,css:{visibility:"hidden"},shadowMode:a.shadowMode}),_each(d,function(){this.title&&g.addItem(this)}),h=_docElement(g.doc),i=g.div.height(),b.clientY+i>=h.clientHeight-100&&g.pos(g.x,_removeUnit(g.y)-i),g.div.css("visibility","visible"),a.menu=g)}})}function _bindNewlineEvent(){function f(a){for(var b=K(a.commonAncestor());b&&(1!=b.type||b.isStyle());)b=b.parent();return b.name}var d,e,a=this,b=a.edit.doc,c=a.newlineTag;_IE&&"br"!==c||_GECKO&&3>_V&&"p"!==c||_OPERA&&9>_V||(d=_toMap("h1,h2,h3,h4,h5,h6,pre,li"),e=_toMap("p,h1,h2,h3,h4,h5,h6,pre,li,blockquote"),K(b).keydown(function(g){if(!(13!=g.which||g.shiftKey||g.ctrlKey||g.altKey)){a.cmd.selection();var h=f(a.cmd.range);if("marquee"!=h&&"select"!=h)return"br"!==c||d[h]?(e[h]||_nativeCommand(b,"formatblock","<p>"),void 0):(g.preventDefault(),a.insertHtml("<br />"+(_IE&&9>_V?"":"â€‹")),void 0)}}),K(b).keyup(function(d){var g,h,i,j,k,l,m;if(!(13!=d.which||d.shiftKey||d.ctrlKey||d.altKey)&&"br"!=c){if(_GECKO)return g=a.cmd.commonAncestor("p"),h=a.cmd.commonAncestor("a"),h&&""==h.text()&&(h.remove(!0),a.cmd.range.selectNodeContents(g[0]).collapse(!0),a.cmd.select()),void 0;if(a.cmd.selection(),i=f(a.cmd.range),"marquee"!=i&&"select"!=i&&(e[i]||_nativeCommand(b,"formatblock","<p>"),j=a.cmd.commonAncestor("div"))){for(k=K("<p></p>"),l=j[0].firstChild;l;)m=l.nextSibling,k.append(l),l=m;j.before(k),j.remove(),a.cmd.range.selectNodeContents(k[0]),a.cmd.select()}}}))}function _bindTabEvent(){var a=this,b=a.edit.doc;K(b).keydown(function(c){if(9==c.which){if(c.preventDefault(),a.afterTab)return a.afterTab.call(a,c),void 0;var d=a.cmd,e=d.range;e.shrink(),e.collapsed&&1==e.startContainer.nodeType&&(e.insertNode(K("@&nbsp;",b)[0]),d.select()),a.insertHtml("&nbsp;&nbsp;&nbsp;&nbsp;")}})}function _bindFocusEvent(){var a=this;K(a.edit.textarea[0],a.edit.win).focus(function(b){a.afterFocus&&a.afterFocus.call(a,b)}).blur(function(b){a.afterBlur&&a.afterBlur.call(a,b)})}function _removeBookmarkTag(a){return _trim(a.replace(/<span [^>]*id="?__kindeditor_bookmark_\w+_\d+__"?[^>]*><\/span>/gi,""))}function _removeTempTag(a){return a.replace(/<div[^>]+class="?__kindeditor_paste__"?[^>]*>[\s\S]*?<\/div>/gi,"")}function _addBookmarkToStack(a,b){if(0===a.length)return a.push(b),void 0;var c=a[a.length-1];_removeBookmarkTag(b.html)!==_removeBookmarkTag(c.html)&&a.push(b)}function _undoToRedo(a,b){var f,g,h,c=this,d=c.edit,e=d.doc.body;return 0===a.length?c:(d.designMode?(f=c.cmd.range,g=f.createBookmark(!0),g.html=e.innerHTML):g={html:e.innerHTML},_addBookmarkToStack(b,g),h=a.pop(),_removeBookmarkTag(g.html)===_removeBookmarkTag(h.html)&&a.length>0&&(h=a.pop()),d.designMode?(d.html(h.html),h.start&&(f.moveToBookmark(h),c.select())):K(e).html(_removeBookmarkTag(h.html)),c)
}function KEditor(a){function c(a,c){KEditor.prototype[a]===undefined&&(b[a]=c),b.options[a]=c}var d,b=this;b.options={},_each(a,function(b){c(b,a[b])}),_each(K.options,function(a,d){b[a]===undefined&&c(a,d)}),d=K(b.srcElement||"<textarea/>"),b.width||(b.width=d[0].style.width||d.width()),b.height||(b.height=d[0].style.height||d.height()),c("width",_undef(b.width,b.minWidth)),c("height",_undef(b.height,b.minHeight)),c("width",_addUnit(b.width)),c("height",_addUnit(b.height)),_MOBILE&&(!_IOS||534>_V)&&(b.designMode=!1),b.srcElement=d,b.initContent="",b.plugin={},b.isCreated=!1,b._handlers={},b._contextmenus=[],b._undoStack=[],b._redoStack=[],b._firstAddBookmark=!0,b.menu=b.contextmenu=null,b.dialogs=[]}function _editor(a){return new KEditor(a)}function _create(a,b){function c(a){return _each(_plugins,function(b,c){_isFunction(c)&&c.call(a,KindEditor)}),a.create()}var d,e;return b=b||{},b.basePath=_undef(b.basePath,K.basePath),b.themesPath=_undef(b.themesPath,b.basePath+"themes/"),b.langPath=_undef(b.langPath,b.basePath+"lang/"),b.pluginsPath=_undef(b.pluginsPath,b.basePath+"plugins/"),d=K(a),d&&0!==d.length?d.length>1?(d.each(function(){_create(this,b)}),_instances[0]):(b.srcElement=d[0],e=new KEditor(b),_instances.push(e),_language[e.langType]?c(e):(_loadScript(e.langPath+e.langType+".js?ver="+encodeURIComponent(K.DEBUG?_TIME:_VERSION),function(){c(e)}),e)):void 0}function _eachEditor(a,b){K(a).each(function(a,c){K.each(_instances,function(a,d){return d&&d.srcElement[0]==c?(b.call(d,a),!1):void 0})})}var _VERSION,_ua,_IE,_NEWIE,_GECKO,_WEBKIT,_OPERA,_MOBILE,_IOS,_QUIRKS,_IERANGE,_matches,_V,_TIME,_round,K,_INLINE_TAG_MAP,_BLOCK_TAG_MAP,_SINGLE_TAG_MAP,_STYLE_TAG_MAP,_CONTROL_TAG_MAP,_PRE_TAG_MAP,_NOSPLIT_TAG_MAP,_AUTOCLOSE_TAG_MAP,_FILL_ATTR_MAP,_VALUE_TAG_MAP,_useCapture,_INPUT_KEY_MAP,_CURSORMOVE_KEY_MAP,_CHANGE_KEY_MAP,_EVENT_PROPS,_eventExpendo,_eventId,_eventData,_readyFinished,_getSetAttrDiv,_GET_SET_ATTRIBUTE,_K,_START_TO_START,_START_TO_END,_END_TO_END,_END_TO_START,_BOOKMARK_ID,html,_direction,_plugins,_language,_instances;window.KindEditor||(window.console||(window.console={}),console.log||(console.log=function(){}),_VERSION="4.1.10 (2013-11-23)",_ua=navigator.userAgent.toLowerCase(),_IE=_ua.indexOf("msie")>-1&&-1==_ua.indexOf("opera"),_NEWIE=-1==_ua.indexOf("msie")&&_ua.indexOf("trident")>-1,_GECKO=_ua.indexOf("gecko")>-1&&-1==_ua.indexOf("khtml"),_WEBKIT=_ua.indexOf("applewebkit")>-1,_OPERA=_ua.indexOf("opera")>-1,_MOBILE=_ua.indexOf("mobile")>-1,_IOS=/ipad|iphone|ipod/.test(_ua),_QUIRKS="CSS1Compat"!=document.compatMode,_IERANGE=!window.getSelection,_matches=/(?:msie|firefox|webkit|opera)[\/:\s](\d+)/.exec(_ua),_V=_matches?_matches[1]:"0",_TIME=(new Date).getTime(),_round=Math.round,K={DEBUG:!1,VERSION:_VERSION,IE:_IE,GECKO:_GECKO,WEBKIT:_WEBKIT,OPERA:_OPERA,V:_V,TIME:_TIME,each:_each,isArray:_isArray,isFunction:_isFunction,inArray:_inArray,inString:_inString,trim:_trim,addUnit:_addUnit,removeUnit:_removeUnit,escape:_escape,unescape:_unescape,toCamel:_toCamel,toHex:_toHex,toMap:_toMap,toArray:_toArray,undef:_undef,invalidUrl:_invalidUrl,addParam:_addParam,extend:_extend,json:_json},_INLINE_TAG_MAP=_toMap("a,abbr,acronym,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,img,input,ins,kbd,label,map,q,s,samp,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),_BLOCK_TAG_MAP=_toMap("address,applet,blockquote,body,center,dd,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,head,hr,html,iframe,ins,isindex,li,map,menu,meta,noframes,noscript,object,ol,p,pre,script,style,table,tbody,td,tfoot,th,thead,title,tr,ul"),_SINGLE_TAG_MAP=_toMap("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),_STYLE_TAG_MAP=_toMap("b,basefont,big,del,em,font,i,s,small,span,strike,strong,sub,sup,u"),_CONTROL_TAG_MAP=_toMap("img,table,input,textarea,button"),_PRE_TAG_MAP=_toMap("pre,style,script"),_NOSPLIT_TAG_MAP=_toMap("html,head,body,td,tr,table,ol,ul,li"),_AUTOCLOSE_TAG_MAP=_toMap("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),_FILL_ATTR_MAP=_toMap("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),_VALUE_TAG_MAP=_toMap("input,button,textarea,select"),K.basePath=_getBasePath(),K.options={designMode:!0,fullscreenMode:!1,filterMode:!0,wellFormatMode:!0,shadowMode:!0,loadStyleMode:!0,basePath:K.basePath,themesPath:K.basePath+"themes/",langPath:K.basePath+"lang/",pluginsPath:K.basePath+"plugins/",themeType:"default",langType:"zh_CN",urlType:"",newlineTag:"p",resizeType:2,syncType:"form",pasteType:2,dialogAlignType:"page",useContextmenu:!0,fullscreenShortcut:!1,bodyClass:"ke-content",indentChar:"	",cssPath:"",cssData:"",minWidth:650,minHeight:100,minChangeSize:50,zIndex:811213,items:["source","|","undo","redo","|","preview","print","template","code","cut","copy","paste","plainpaste","wordpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","outdent","subscript","superscript","clearhtml","quickformat","selectall","|","fullscreen","/","formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","lineheight","removeformat","|","image","multiimage","flash","media","insertfile","table","hr","emoticons","baidumap","pagebreak","anchor","link","unlink","|","about"],noDisableItems:["source","fullscreen"],colorTable:[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]],fontSizeTable:["9px","10px","12px","14px","16px","18px","24px","32px"],htmlTags:{font:["id","class","color","size","face",".background-color"],span:["id","class",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".line-height"],div:["id","class","align",".border",".margin",".padding",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".background",".font-style",".text-decoration",".vertical-align",".margin-left"],table:["id","class","border","cellspacing","cellpadding","width","height","align","bordercolor",".padding",".margin",".border","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".background",".width",".height",".border-collapse"],"td,th":["id","class","align","valign","width","height","colspan","rowspan","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".vertical-align",".background",".border"],a:["id","class","href","target","name"],embed:["id","class","src","width","height","type","loop","autostart","quality",".width",".height","align","allowscriptaccess"],img:["id","class","src","width","height","border","alt","title","align",".width",".height",".border"],"p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":["id","class","align",".text-align",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".text-indent",".margin-left"],pre:["id","class"],hr:["id","class",".page-break-after"],"br,tbody,tr,strong,b,sub,sup,em,i,u,strike,s,del":["id","class"],iframe:["id","class","src","frameborder","width","height",".width",".height"]},layout:'<div class="container"><div class="toolbar"></div><div class="edit"></div><div class="statusbar"></div></div>'},_useCapture=!1,_INPUT_KEY_MAP=_toMap("8,9,13,32,46,48..57,59,61,65..90,106,109..111,188,190..192,219..222"),_CURSORMOVE_KEY_MAP=_toMap("33..40"),_CHANGE_KEY_MAP={},_each(_INPUT_KEY_MAP,function(a,b){_CHANGE_KEY_MAP[a]=b}),_each(_CURSORMOVE_KEY_MAP,function(a,b){_CHANGE_KEY_MAP[a]=b}),_EVENT_PROPS="altKey,attrChange,attrName,bubbles,button,cancelable,charCode,clientX,clientY,ctrlKey,currentTarget,data,detail,eventPhase,fromElement,handler,keyCode,metaKey,newValue,offsetX,offsetY,originalTarget,pageX,pageY,prevValue,relatedNode,relatedTarget,screenX,screenY,shiftKey,srcElement,target,toElement,view,wheelDelta,which".split(","),_extend(KEvent,{init:function(a,b){var e,f,c=this,d=a.ownerDocument||a.document||a;switch(c.event=b,_each(_EVENT_PROPS,function(a,d){c[d]=b[d]}),c.target||(c.target=c.srcElement||d),3===c.target.nodeType&&(c.target=c.target.parentNode),!c.relatedTarget&&c.fromElement&&(c.relatedTarget=c.fromElement===c.target?c.toElement:c.fromElement),null==c.pageX&&null!=c.clientX&&(e=d.documentElement,f=d.body,c.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),c.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),!c.which&&(c.charCode||0===c.charCode?c.charCode:c.keyCode)&&(c.which=c.charCode||c.keyCode),!c.metaKey&&c.ctrlKey&&(c.metaKey=c.ctrlKey),c.which||c.button===undefined||(c.which=1&c.button?1:2&c.button?3:4&c.button?2:0),c.which){case 186:c.which=59;break;case 187:case 107:case 43:c.which=61;break;case 189:case 45:c.which=109;break;case 42:c.which=106;break;case 47:c.which=111;break;case 78:c.which=110}c.which>=96&&c.which<=105&&(c.which-=48)},preventDefault:function(){var a=this.event;a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){var a=this.event;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},stop:function(){this.preventDefault(),this.stopPropagation()}}),_eventExpendo="kindeditor_"+_TIME,_eventId=0,_eventData={},_readyFinished=!1,_IE&&window.attachEvent("onunload",function(){_each(_eventData,function(a,b){b.el&&_unbind(b.el)})}),K.ctrl=_ctrl,K.ready=_ready,K.formatUrl=_formatUrl,K.formatHtml=_formatHtml,K.getCssList=_getCssList,K.getAttrList=_getAttrList,K.mediaType=_mediaType,K.mediaAttrs=_mediaAttrs,K.mediaEmbed=_mediaEmbed,K.mediaImg=_mediaImg,K.clearMsWord=_clearMsWord,K.tmpl=_tmpl,_getSetAttrDiv=document.createElement("div"),_getSetAttrDiv.setAttribute("className","t"),_GET_SET_ATTRIBUTE="t"!==_getSetAttrDiv.className,K.query=_query,K.queryAll=_queryAll,_extend(KNode,{init:function(a){var c,d,e,b=this;for(a=_isArray(a)?a:[a],c=0,d=0,e=a.length;e>d;d++)a[d]&&(b[d]=a[d].constructor===KNode?a[d][0]:a[d],c++);b.length=c,b.doc=_getDoc(b[0]),b.name=_getNodeName(b[0]),b.type=b.length>0?b[0].nodeType:null,b.win=_getWin(b[0])},each:function(a){var c,b=this;for(c=0;c<b.length;c++)if(a.call(b[c],c,b[c])===!1)return b;return b},bind:function(a,b){return this.each(function(){_bind(this,a,b)}),this},unbind:function(a,b){return this.each(function(){_unbind(this,a,b)}),this},fire:function(a){return this.length<1?this:(_fire(this[0],a),this)},hasAttr:function(a){return this.length<1?!1:!!_getAttr(this[0],a)},attr:function(a,b){var c=this;return a===undefined?_getAttrList(c.outer()):"object"==typeof a?(_each(a,function(a,b){c.attr(a,b)}),c):b===undefined?(b=c.length<1?null:_getAttr(c[0],a),null===b?"":b):(c.each(function(){_setAttr(this,a,b)}),c)},removeAttr:function(a){return this.each(function(){_removeAttr(this,a)}),this},get:function(a){return this.length<1?null:this[a||0]},eq:function(a){return this.length<1?null:this[a]?new KNode(this[a]):null},hasClass:function(a){return this.length<1?!1:_hasClass(this[0],a)},addClass:function(a){return this.each(function(){_hasClass(this,a)||(this.className=_trim(this.className+" "+a))}),this},removeClass:function(a){return this.each(function(){_hasClass(this,a)&&(this.className=_trim(this.className.replace(new RegExp("(^|\\s)"+a+"(\\s|$)")," ")))}),this},html:function(a){var b=this;return a===undefined?b.length<1||1!=b.type?"":_formatHtml(b[0].innerHTML):(b.each(function(){_setHtml(this,a)}),b)},text:function(){var a=this;return a.length<1?"":_IE?a[0].innerText:a[0].textContent},hasVal:function(){return this.length<1?!1:_hasVal(this[0])},val:function(a){var b=this;return a===undefined?b.length<1?"":b.hasVal()?b[0].value:b.attr("value"):(b.each(function(){_hasVal(this)?this.value=a:_setAttr(this,"value",a)}),b)},css:function(a,b){var c=this;return a===undefined?_getCssList(c.attr("style")):"object"==typeof a?(_each(a,function(a,b){c.css(a,b)}),c):b===undefined?c.length<1?"":c[0].style[_toCamel(a)]||_computedCss(c[0],a)||"":(c.each(function(){this.style[_toCamel(a)]=b}),c)},width:function(a){var b=this;return a===undefined?b.length<1?0:b[0].offsetWidth:b.css("width",_addUnit(a))},height:function(a){var b=this;return a===undefined?b.length<1?0:b[0].offsetHeight:b.css("height",_addUnit(a))},opacity:function(a){return this.each(function(){this.style.opacity===undefined?this.style.filter=1==a?"":"alpha(opacity="+100*a+")":this.style.opacity=1==a?"":a}),this},data:function(a,b){var c=this;return a="kindeditor_data_"+a,b===undefined?c.length<1?null:c[0][a]:(this.each(function(){this[a]=b}),c)},pos:function(){var e,f,a=this,b=a[0],c=0,d=0;if(b)if(b.getBoundingClientRect)e=b.getBoundingClientRect(),f=_getScrollPos(a.doc),c=e.left+f.x,d=e.top+f.y;else for(;b;)c+=b.offsetLeft,d+=b.offsetTop,b=b.offsetParent;return{x:_round(c),y:_round(d)}},clone:function(a){return this.length<1?new KNode([]):new KNode(this[0].cloneNode(a))},append:function(a){return this.each(function(){this.appendChild&&this.appendChild(_get(a))}),this},appendTo:function(a){return this.each(function(){_get(a).appendChild(this)}),this},before:function(a){return this.each(function(){this.parentNode.insertBefore(_get(a),this)}),this},after:function(a){return this.each(function(){this.nextSibling?this.parentNode.insertBefore(_get(a),this.nextSibling):this.parentNode.appendChild(_get(a))}),this},replaceWith:function(a){var b=[];return this.each(function(c,d){_unbind(d);var e=_get(a);d.parentNode.replaceChild(e,d),b.push(e)}),K(b)},empty:function(){var a=this;return a.each(function(a,b){for(var d,c=b.firstChild;c;){if(!b.parentNode)return;d=c.nextSibling,c.parentNode.removeChild(c),c=d}}),a},remove:function(a){var b=this;return b.each(function(c,d){var e,f;if(d.parentNode){if(_unbind(d),a)for(e=d.firstChild;e;)f=e.nextSibling,d.parentNode.insertBefore(e,d),e=f;d.parentNode.removeChild(d),delete b[c]}}),b.length=0,b},show:function(a){var b=this;return a===undefined&&(a=b._originDisplay||""),"none"!=b.css("display")?b:b.css("display",a)},hide:function(){var a=this;return a.length<1?a:(a._originDisplay=a[0].style.display,a.css("display","none"))},outer:function(){var c,b,a=this;return a.length<1?"":(b=a.doc.createElement("div"),b.appendChild(a[0].cloneNode(!0)),c=_formatHtml(b.innerHTML),b=null,c)},isSingle:function(){return!!_SINGLE_TAG_MAP[this.name]},isInline:function(){return!!_INLINE_TAG_MAP[this.name]},isBlock:function(){return!!_BLOCK_TAG_MAP[this.name]},isStyle:function(){return!!_STYLE_TAG_MAP[this.name]},isControl:function(){return!!_CONTROL_TAG_MAP[this.name]},contains:function(a){return this.length<1?!1:_contains(this[0],_get(a))},parent:function(){if(this.length<1)return null;var a=this[0].parentNode;return a?new KNode(a):null},children:function(){if(this.length<1)return new KNode([]);for(var a=[],b=this[0].firstChild;b;)(3!=b.nodeType||""!==_trim(b.nodeValue))&&a.push(b),b=b.nextSibling;return new KNode(a)},first:function(){var a=this.children();return a.length>0?a.eq(0):null},last:function(){var a=this.children();return a.length>0?a.eq(a.length-1):null},index:function(){if(this.length<1)return-1;for(var a=-1,b=this[0];b;)a++,b=b.previousSibling;return a},prev:function(){if(this.length<1)return null;var a=this[0].previousSibling;return a?new KNode(a):null},next:function(){if(this.length<1)return null;var a=this[0].nextSibling;return a?new KNode(a):null},scan:function(a,b){function c(d){for(var f,e=b?d.firstChild:d.lastChild;e;){if(f=b?e.nextSibling:e.previousSibling,a(e)===!1)return!1;if(c(e)===!1)return!1;e=f}}if(!(this.length<1))return b=b===undefined?!0:b,c(this[0]),this}}),_each("blur,focus,focusin,focusout,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error,contextmenu".split(","),function(a,b){KNode.prototype[b]=function(a){return a?this.bind(b,a):this.fire(b)}}),_K=K,K=function(a,b){function c(a){return a[0]||(a=[]),new KNode(a)}var d,e,f,g,h,i,j;if(a!==undefined&&null!==a){if("string"==typeof a){if(b&&(b=_get(b)),d=a.length,"@"===a.charAt(0)&&(a=a.substr(1)),a.length!==d||/<.+>/.test(a)){for(e=b?b.ownerDocument||b:document,f=e.createElement("div"),g=[],f.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+a,h=0,i=f.childNodes.length;i>h;h++)j=f.childNodes[h],"__kindeditor_temp_tag__"!=j.id&&g.push(j);return c(g)}return c(_queryAll(a,b))}return a&&a.constructor===KNode?a:(a.toArray&&(a=a.toArray()),_isArray(a)?c(a):c(_toArray(arguments)))}},_each(_K,function(a,b){K[a]=b}),K.NodeClass=KNode,window.KindEditor=K,_START_TO_START=0,_START_TO_END=1,_END_TO_END=2,_END_TO_START=3,_BOOKMARK_ID=0,_extend(KRange,{init:function(a){var b=this;b.startContainer=a,b.startOffset=0,b.endContainer=a,b.endOffset=0,b.collapsed=!0,b.doc=a},commonAncestor:function(){function a(a){for(var b=[];a;)b.push(a),a=a.parentNode;return b}for(var g,h,b=a(this.startContainer),c=a(this.endContainer),d=0,e=b.length,f=c.length;++d&&(g=b[e-d],h=c[f-d],g&&h&&g===h););return b[e-d+1]},setStart:function(a,b){var c=this,d=c.doc;return c.startContainer=a,c.startOffset=b,c.endContainer===d&&(c.endContainer=a,c.endOffset=b),_updateCollapsed(this)},setEnd:function(a,b){var c=this,d=c.doc;return c.endContainer=a,c.endOffset=b,c.startContainer===d&&(c.startContainer=a,c.startOffset=b),_updateCollapsed(this)},setStartBefore:function(a){return this.setStart(a.parentNode||this.doc,K(a).index())},setStartAfter:function(a){return this.setStart(a.parentNode||this.doc,K(a).index()+1)},setEndBefore:function(a){return this.setEnd(a.parentNode||this.doc,K(a).index())},setEndAfter:function(a){return this.setEnd(a.parentNode||this.doc,K(a).index()+1)},selectNode:function(a){return this.setStartBefore(a).setEndAfter(a)},selectNodeContents:function(a){var c,b=K(a);return 3==b.type||b.isSingle()?this.selectNode(a):(c=b.children(),c.length>0?this.setStartBefore(c[0]).setEndAfter(c[c.length-1]):this.setStart(a,0).setEnd(a,0))},collapse:function(a){return a?this.setEnd(this.startContainer,this.startOffset):this.setStart(this.endContainer,this.endOffset)},compareBoundaryPoints:function(a,b){var e,f,g,h,i,j,k,l,c=this.get(),d=b.get();if(!_IERANGE)return c.compareBoundaryPoints(a,d);if(e={},e[_START_TO_START]="StartToStart",e[_START_TO_END]="EndToStart",e[_END_TO_END]="EndToEnd",e[_END_TO_START]="StartToEnd",f=c.compareEndPoints(e[a],d),0!==f)return f;if((a===_START_TO_START||a===_END_TO_START)&&(g=this.startContainer,j=this.startOffset),(a===_START_TO_END||a===_END_TO_END)&&(g=this.endContainer,j=this.endOffset),(a===_START_TO_START||a===_START_TO_END)&&(h=b.startContainer,k=b.startOffset),(a===_END_TO_END||a===_END_TO_START)&&(h=b.endContainer,k=b.endOffset),g===h)return l=j-k,l>0?1:0>l?-1:0;for(i=h;i&&i.parentNode!==g;)i=i.parentNode;if(i)return K(i).index()>=j?-1:1;for(i=g;i&&i.parentNode!==h;)i=i.parentNode;return i?K(i).index()>=k?1:-1:(i=K(h).next(),i&&i.contains(g)?1:(i=K(g).next(),i&&i.contains(h)?-1:void 0))},cloneRange:function(){return new KRange(this.doc).setStart(this.startContainer,this.startOffset).setEnd(this.endContainer,this.endOffset)},toString:function(){var a=this.get(),b=_IERANGE?a.text:a.toString();return b.replace(/\r\n|\n|\r/g,"")},cloneContents:function(){return _copyAndDelete(this,!0,!1)},deleteContents:function(){return _copyAndDelete(this,!1,!0)},extractContents:function(){return _copyAndDelete(this,!0,!0)},insertNode:function(a){var g,h,i,b=this,c=b.startContainer,d=b.startOffset,e=b.endContainer,f=b.endOffset,j=1;return"#document-fragment"===a.nodeName.toLowerCase()&&(g=a.firstChild,h=a.lastChild,j=a.childNodes.length),1==c.nodeType?(i=c.childNodes[d],i?(c.insertBefore(a,i),c===e&&(f+=j)):c.appendChild(a)):3==c.nodeType&&(0===d?(c.parentNode.insertBefore(a,c),c.parentNode===e&&(f+=j)):d>=c.nodeValue.length?c.nextSibling?c.parentNode.insertBefore(a,c.nextSibling):c.parentNode.appendChild(a):(i=d>0?c.splitText(d):c,c.parentNode.insertBefore(a,i),c===e&&(e=i,f-=d))),g?b.setStartBefore(g).setEndAfter(h):b.selectNode(a),b.compareBoundaryPoints(_END_TO_END,b.cloneRange().setEnd(e,f))>=1?b:b.setEnd(e,f)},surroundContents:function(a){return a.appendChild(this.extractContents()),this.insertNode(a).selectNode(a)},isControl:function(){var a=this,b=a.startContainer,c=a.startOffset,d=a.endContainer,e=a.endOffset;return 1==b.nodeType&&b===d&&c+1===e&&K(b.childNodes[c]).isControl()},get:function(a){var e,g,b=this,c=b.doc;if(!_IERANGE){e=c.createRange();try{e.setStart(b.startContainer,b.startOffset),e.setEnd(b.endContainer,b.endOffset)}catch(f){}return e}return a&&b.isControl()?(e=c.body.createControlRange(),e.addElement(b.startContainer.childNodes[b.startOffset]),e):(g=b.cloneRange().down(),e=c.body.createTextRange(),e.setEndPoint("StartToStart",_getEndRange(g.startContainer,g.startOffset)),e.setEndPoint("EndToStart",_getEndRange(g.endContainer,g.endOffset)),e)},html:function(){return K(this.cloneContents()).outer()},down:function(){function b(b,c,d){var e,f,g,h,i;1==b.nodeType&&(e=K(b).children(),0!==e.length&&(c>0&&(f=e.eq(c-1)),c<e.length&&(g=e.eq(c)),f&&3==f.type&&(h=f[0],i=h.nodeValue.length),g&&3==g.type&&(h=g[0],i=0),h&&(d?a.setStart(h,i):a.setEnd(h,i))))}var a=this;return b(a.startContainer,a.startOffset,!0),b(a.endContainer,a.endOffset,!1),a},up:function(){function b(b,c,d){3==b.nodeType&&(0===c?d?a.setStartBefore(b):a.setEndBefore(b):c==b.nodeValue.length&&(d?a.setStartAfter(b):a.setEndAfter(b)))}var a=this;return b(a.startContainer,a.startOffset,!0),b(a.endContainer,a.endOffset,!1),a},enlarge:function(a){function c(c,d,e){var g,f=K(c);if(!(3==f.type||_NOSPLIT_TAG_MAP[f.name]||!a&&f.isBlock()))if(0===d){for(;!f.prev()&&(g=f.parent(),g&&!_NOSPLIT_TAG_MAP[g.name]&&(a||!g.isBlock()));)f=g;e?b.setStartBefore(f[0]):b.setEndBefore(f[0])}else if(d==f.children().length){for(;!f.next()&&(g=f.parent(),g&&!_NOSPLIT_TAG_MAP[g.name]&&(a||!g.isBlock()));)f=g;e?b.setStartAfter(f[0]):b.setEndAfter(f[0])}}var b=this;return b.up(),c(b.startContainer,b.startOffset,!0),c(b.endContainer,b.endOffset,!1),b},shrink:function(){for(var b,a=this,c=a.collapsed;1==a.startContainer.nodeType&&(b=a.startContainer.childNodes[a.startOffset])&&1==b.nodeType&&!K(b).isSingle();)a.setStart(b,0);if(c)return a.collapse(c);for(;1==a.endContainer.nodeType&&a.endOffset>0&&(b=a.endContainer.childNodes[a.endOffset-1])&&1==b.nodeType&&!K(b).isSingle();)a.setEnd(b,b.childNodes.length);return a},createBookmark:function(a){var d,b=this,c=b.doc,e=K('<span style="display:none;"></span>',c)[0];return e.id="__kindeditor_bookmark_start_"+_BOOKMARK_ID++ +"__",b.collapsed||(d=e.cloneNode(!0),d.id="__kindeditor_bookmark_end_"+_BOOKMARK_ID++ +"__"),d&&b.cloneRange().collapse(!1).insertNode(d).setEndBefore(d),b.insertNode(e).setStartAfter(e),{start:a?"#"+e.id:e,end:d?a?"#"+d.id:d:null}},moveToBookmark:function(a){var b=this,c=b.doc,d=K(a.start,c),e=a.end?K(a.end,c):null;return!d||d.length<1?b:(b.setStartBefore(d[0]),d.remove(),e&&e.length>0?(b.setEndBefore(e[0]),e.remove()):b.collapse(!0),b)},dump:function(){console.log("--------------------"),console.log(3==this.startContainer.nodeType?this.startContainer.nodeValue:this.startContainer,this.startOffset),console.log(3==this.endContainer.nodeType?this.endContainer.nodeValue:this.endContainer,this.endOffset)}}),K.RangeClass=KRange,K.range=_range,K.START_TO_START=_START_TO_START,K.START_TO_END=_START_TO_END,K.END_TO_END=_END_TO_END,K.END_TO_START=_END_TO_START,_extend(KCmd,{init:function(a){var b=this,c=a.doc;b.doc=c,b.win=_getWin(c),b.sel=_getSel(c),b.range=a},selection:function(a){var b=this,c=b.doc,d=_getRng(c);return b.sel=_getSel(c),d?(b.range=_range(d),"html"==K(b.range.startContainer).name&&b.range.selectNodeContents(c.body).collapse(!1),b):(a&&b.range.selectNodeContents(c.body).collapse(!1),b)},select:function(a){var k,b,c,d,e,f,i,j,l,m,o,q;if(a=_undef(a,!0),b=this,c=b.sel,d=b.range.cloneRange().shrink(),e=d.startContainer,f=d.startOffset,d.endContainer,d.endOffset,i=_getDoc(e),j=b.win,l=!1,a&&1==e.nodeType&&d.collapsed){if(_IERANGE){m=K("<span>&nbsp;</span>",i),d.insertNode(m[0]),k=i.body.createTextRange();try{k.moveToElementText(m[0])}catch(n){}return k.collapse(!1),k.select(),m.remove(),j.focus(),b}_WEBKIT&&(o=e.childNodes,(K(e).isInline()||f>0&&K(o[f-1]).isInline()||o[f]&&K(o[f]).isInline())&&(d.insertNode(i.createTextNode("â€‹")),l=!0))}if(_IERANGE)try{k=d.get(!0),k.select()}catch(p){}else l&&d.collapse(!1),k=d.get(!0),c.removeAllRanges(),c.addRange(k),i!==document&&(q=K(k.endContainer).pos(),j.scrollTo(q.x,q.y));return j.focus(),b},wrap:function(a){var f,g,h,i,j,b=this,c=b.doc,d=b.range,e=K(a,c);if(d.collapsed)return d.shrink(),d.insertNode(e[0]).selectNodeContents(e[0]),b;if(e.isBlock()){for(f=e.clone(!0),g=f;g.first();)g=g.first();return g.append(d.extractContents()),d.insertNode(f[0]).selectNode(f[0]),b}return d.enlarge(),h=d.createBookmark(),i=d.commonAncestor(),j=!1,K(i).scan(function(a){var b,c;if(!j&&a==h.start)return j=!0,void 0;if(j){if(a==h.end)return!1;if(b=K(a),_inPreElement(b))return;if(3==b.type&&_trim(a.nodeValue).length>0){for(;(c=b.parent())&&c.isStyle()&&1==c.children().length;)b=c;_wrapNode(b,e)}}}),d.moveToBookmark(h),b},split:function(a,b){for(var j,k,l,m,n,o,p,q,c=this.range,d=c.doc,e=c.cloneRange().collapse(a),f=e.startContainer,g=e.startOffset,h=3==f.nodeType?f.parentNode:f,i=!1;h&&h.parentNode;){if(j=K(h),b){if(!j.isStyle())break;if(!_hasAttrOrCss(j,b))break}else if(_NOSPLIT_TAG_MAP[j.name])break;i=!0,h=h.parentNode}return i&&(k=d.createElement("span"),c.cloneRange().collapse(!a).insertNode(k),a?e.setStartBefore(h.firstChild).setEnd(f,g):e.setStart(f,g).setEndAfter(h.lastChild),l=e.extractContents(),m=l.firstChild,n=l.lastChild,a?(e.insertNode(l),c.setStartAfter(n).setEndBefore(k)):(h.appendChild(l),c.setStartBefore(k).setEndBefore(m)),o=k.parentNode,o==c.endContainer&&(p=K(k).prev(),q=K(k).next(),p&&q&&3==p.type&&3==q.type?c.setEnd(p[0],p[0].nodeValue.length):a||c.setEnd(c.endContainer,c.endOffset-1)),o.removeChild(k)),this},remove:function(a){var f,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,b=this,c=b.doc,d=b.range;if(d.enlarge(),0===d.startOffset){for(e=K(d.startContainer);(f=e.parent())&&f.isStyle()&&1==f.children().length;)e=f;d.setStart(e[0],0),e=K(d.startContainer),e.isBlock()&&_removeAttrOrCss(e,a),g=e.parent(),g&&g.isBlock()&&_removeAttrOrCss(g,a)}return d.collapsed?(b.split(!0,a),h=d.startContainer,i=d.startOffset,i>0&&(j=K(h.childNodes[i-1]),j&&_isEmptyNode(j)&&(j.remove(),d.setStart(h,i-1))),k=K(h.childNodes[i]),k&&_isEmptyNode(k)&&k.remove(),_isEmptyNode(h)&&(d.startBefore(h),h.remove()),d.collapse(!0),b):(b.split(!0,a),b.split(!1,a),l=c.createElement("span"),m=c.createElement("span"),d.cloneRange().collapse(!1).insertNode(m),d.cloneRange().collapse(!0).insertNode(l),n=[],o=!1,K(d.commonAncestor()).scan(function(a){return o||a!=l?a==m?!1:(o&&n.push(a),void 0):(o=!0,void 0)}),K(l).remove(),K(m).remove(),h=d.startContainer,i=d.startOffset,p=d.endContainer,q=d.endOffset,i>0&&(r=K(h.childNodes[i-1]),r&&_isEmptyNode(r)&&(r.remove(),d.setStart(h,i-1),h==p&&d.setEnd(p,q-1)),s=K(h.childNodes[i]),s&&_isEmptyNode(s)&&(s.remove(),h==p&&d.setEnd(p,q-1))),t=K(p.childNodes[d.endOffset]),t&&_isEmptyNode(t)&&t.remove(),u=d.createBookmark(!0),_each(n,function(b,c){_removeAttrOrCss(K(c),a)}),d.moveToBookmark(u),b)},commonNode:function(a){function f(b){for(var c=b,d=b;d;){if(_hasAttrOrCss(K(d),a))return K(d);d=d.parentNode}for(;c&&(c=c.lastChild);)if(_hasAttrOrCss(K(c),a))return K(c);return null}var h,b=this.range,c=b.endContainer,d=b.endOffset,e=3==c.nodeType||0===d?c:c.childNodes[d-1],g=f(e);return g?g:(1==e.nodeType||3==c.nodeType&&0===d)&&(h=K(e).prev())?f(h):null},commonAncestor:function(a){function i(b){for(;b;){if(1==b.nodeType&&b.tagName.toLowerCase()===a)return b;b=b.parentNode}return null}var b=this.range,c=b.startContainer,d=b.startOffset,e=b.endContainer,f=b.endOffset,g=3==c.nodeType||0===d?c:c.childNodes[d-1],h=3==e.nodeType||0===f?e:e.childNodes[f-1],j=i(g),k=i(h);return j&&k&&j===k?K(j):null},state:function(a){var b=this,c=b.doc,d=!1;try{d=c.queryCommandState(a)}catch(e){}return d},val:function(a){function e(a){return a.toLowerCase()}var g,f,b=this,c=b.doc;return b.range,a=e(a),f="","fontfamily"===a||"fontname"===a?(f=_nativeCommandValue(c,"fontname"),f=f.replace(/['"]/g,""),e(f)):"formatblock"===a?(f=_nativeCommandValue(c,a),""===f&&(g=b.commonNode({"h1,h2,h3,h4,h5,h6,p,div,pre,address":"*"}),g&&(f=g.name)),"Normal"===f&&(f="p"),e(f)):"fontsize"===a?(g=b.commonNode({"*":".font-size"}),g&&(f=g.css("font-size")),e(f)):"forecolor"===a?(g=b.commonNode({"*":".color"}),g&&(f=g.css("color")),f=_toHex(f),""===f&&(f="default"),e(f)):"hilitecolor"===a?(g=b.commonNode({"*":".background-color"}),g&&(f=g.css("background-color")),f=_toHex(f),""===f&&(f="default"),e(f)):f},toggle:function(a,b){var c=this;return c.commonNode(b)?c.remove(b):c.wrap(a),c.select()},bold:function(){return this.toggle("<strong></strong>",{span:".font-weight=bold",strong:"*",b:"*"})},italic:function(){return this.toggle("<em></em>",{span:".font-style=italic",em:"*",i:"*"})},underline:function(){return this.toggle("<u></u>",{span:".text-decoration=underline",u:"*"})},strikethrough:function(){return this.toggle("<s></s>",{span:".text-decoration=line-through",s:"*"})},forecolor:function(a){return this.wrap('<span style="color:'+a+';"></span>').select()},hilitecolor:function(a){return this.wrap('<span style="background-color:'+a+';"></span>').select()},fontsize:function(a){return this.wrap('<span style="font-size:'+a+';"></span>').select()},fontname:function(a){return this.fontfamily(a)},fontfamily:function(a){return this.wrap('<span style="font-family:'+a+';"></span>').select()},removeformat:function(){var a={"*":".font-weight,.font-style,.text-decoration,.color,.background-color,.font-size,.font-family,.text-indent"},b=_STYLE_TAG_MAP;return _each(b,function(b){a[b]="*"}),this.remove(a),this.select()},inserthtml:function(a,b){function e(a,b){var d,e,f;b='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+b,d=a.get(),d.item?d.item(0).outerHTML=b:d.pasteHTML(b),e=a.doc.getElementById("__kindeditor_temp_tag__"),e.parentNode.removeChild(e),f=_toRange(d),a.setEnd(f.endContainer,f.endOffset),a.collapse(!1),c.select(!1)}function f(a,b){var d=a.doc,e=d.createDocumentFragment();K("@"+b,d).each(function(){e.appendChild(this)}),a.deleteContents(),a.insertNode(e),a.collapse(!1),c.select(!1)}var c=this,d=c.range;if(""===a)return c;if(_IERANGE&&b){try{e(d,a)}catch(g){f(d,a)}return c}return f(d,a),c},hr:function(){return this.inserthtml("<hr />")},print:function(){return this.win.print(),this},insertimage:function(a,b,c,d,e,f){b=_undef(b,""),e=_undef(e,0);var g='<img src="'+_escape(a)+'" data-ke-src="'+_escape(a)+'" ';return c&&(g+='width="'+_escape(c)+'" '),d&&(g+='height="'+_escape(d)+'" '),b&&(g+='title="'+_escape(b)+'" '),f&&(g+='align="'+_escape(f)+'" '),g+='alt="'+_escape(b)+'" ',g+="/>",this.inserthtml(g)},createlink:function(a,b){function i(a,b,c){K(a).attr("href",b).attr("data-ke-src",b),c?K(a).attr("target",c):K(a).removeAttr("target")}var f,g,h,j,k,l,m,n,c=this,d=c.doc,e=c.range;return c.select(),f=c.commonNode({a:"*"}),f&&!e.isControl()&&(e.selectNode(f.get()),c.select()),g='<a href="'+_escape(a)+'" data-ke-src="'+_escape(a)+'" ',b&&(g+=' target="'+_escape(b)+'"'),e.collapsed?(g+=">"+_escape(a)+"</a>",c.inserthtml(g)):e.isControl()?(h=K(e.startContainer.childNodes[e.startOffset]),g+="></a>",h.after(K(g,d)),h.next().append(h),e.selectNode(h[0]),c.select()):(j=e.startContainer,k=e.startOffset,l=e.endContainer,m=e.endOffset,1==j.nodeType&&j===l&&k+1===m&&(n=j.childNodes[k],"a"==n.nodeName.toLowerCase())?(i(n,a,b),c):(_nativeCommand(d,"createlink","__kindeditor_temp_url__"),K('a[href="__kindeditor_temp_url__"]',d).each(function(){i(this,a,b)
}),c))},unlink:function(){var d,e,a=this,b=a.doc,c=a.range;return a.select(),c.collapsed?(d=a.commonNode({a:"*"}),d&&(c.selectNode(d.get()),a.select()),_nativeCommand(b,"unlink",null),_WEBKIT&&"img"===K(c.startContainer).name&&(e=K(c.startContainer).parent(),"a"===e.name&&e.remove(!0))):_nativeCommand(b,"unlink",null),a}}),_each("formatblock,selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,indent,outdent,subscript,superscript".split(","),function(a,b){KCmd.prototype[b]=function(a){var c=this;return c.select(),_nativeCommand(c.doc,b,a),_IERANGE&&_inArray(b,"justifyleft,justifycenter,justifyright,justifyfull".split(","))>=0&&c.selection(),(!_IERANGE||_inArray(b,"formatblock,selectall,insertorderedlist,insertunorderedlist".split(","))>=0)&&c.selection(),c}}),_each("cut,copy,paste".split(","),function(a,b){KCmd.prototype[b]=function(){var a=this;if(!a.doc.queryCommandSupported(b))throw"not supported";return a.select(),_nativeCommand(a.doc,b,null),a}}),K.CmdClass=KCmd,K.cmd=_cmd,_extend(KWidget,{init:function(a){var c,b=this;b.name=a.name||"",b.doc=a.doc||document,b.win=_getWin(b.doc),b.x=_addUnit(a.x),b.y=_addUnit(a.y),b.z=a.z,b.width=_addUnit(a.width),b.height=_addUnit(a.height),b.div=K('<div style="display:block;"></div>'),b.options=a,b._alignEl=a.alignEl,b.width&&b.div.css("width",b.width),b.height&&b.div.css("height",b.height),b.z&&b.div.css({position:"absolute",left:b.x,top:b.y,"z-index":b.z}),!b.z||b.x!==undefined&&b.y!==undefined||b.autoPos(b.width,b.height),a.cls&&b.div.addClass(a.cls),a.shadowMode&&b.div.addClass("ke-shadow"),a.css&&b.div.css(a.css),a.src?K(a.src).replaceWith(b.div):K(b.doc.body).append(b.div),a.html&&b.div.html(a.html),a.autoScroll&&(_IE&&7>_V||_QUIRKS?(c=_getScrollPos(),K(b.win).bind("scroll",function(){var d=_getScrollPos(),e=d.x-c.x,f=d.y-c.y;b.pos(_removeUnit(b.x)+e,_removeUnit(b.y)+f,!1)})):b.div.css("position","fixed"))},pos:function(a,b,c){var d=this;return c=_undef(c,!0),null!==a&&(a=0>a?0:_addUnit(a),d.div.css("left",a),c&&(d.x=a)),null!==b&&(b=0>b?0:_addUnit(b),d.div.css("top",b),c&&(d.y=b)),d},autoPos:function(a,b){var g,h,i,j,k,l,m,c=this,d=_removeUnit(a)||0,e=_removeUnit(b)||0,f=_getScrollPos();return c._alignEl?(i=K(c._alignEl),j=i.pos(),k=_round(i[0].clientWidth/2-d/2),l=_round(i[0].clientHeight/2-e/2),g=0>k?j.x:j.x+k,h=0>l?j.y:j.y+l):(m=_docElement(c.doc),g=_round(f.x+(m.clientWidth-d)/2),h=_round(f.y+(m.clientHeight-e)/2)),_IE&&7>_V||_QUIRKS||(g-=f.x,h-=f.y),c.pos(g,h)},remove:function(){var a=this;return(_IE&&7>_V||_QUIRKS)&&K(a.win).unbind("scroll"),a.div.remove(),_each(a,function(b){a[b]=null}),this},show:function(){return this.div.show(),this},hide:function(){return this.div.hide(),this},draggable:function(a){var b=this;return a=a||{},a.moveEl=b.div,a.moveFn=function(a,c,d,e,f,g){(a+=f)<0&&(a=0),(c+=g)<0&&(c=0),b.pos(a,c)},_drag(a),b}}),K.WidgetClass=KWidget,K.widget=_widget,_direction="",(html=document.getElementsByTagName("html"))&&(_direction=html[0].dir),_extend(KEdit,KWidget,{init:function(a){function j(){var i,h=_iframeDoc(b.iframe);h.open(),g&&(h.domain=document.domain),h.write(_getInitHtml(c,d,e,f)),h.close(),b.win=b.iframe[0].contentWindow,b.doc=h,i=_cmd(h),b.afterChange(function(){i.selection()}),_WEBKIT&&K(h).click(function(a){"img"===K(a.target).name&&(i.selection(!0),i.range.selectNode(a.target),i.select())}),_IE&&(b._mousedownHandler=function(){var a=i.range.cloneRange();a.shrink(),a.isControl()&&b.blur()},K(document).mousedown(b._mousedownHandler),K(h).keydown(function(a){if(8==a.which){i.selection();var b=i.range;b.isControl()&&(b.collapse(!0),K(b.startContainer.childNodes[b.startOffset]).remove(),a.preventDefault())}})),b.cmd=i,b.html(_elementVal(b.srcElement)),_IE?(h.body.disabled=!0,h.body.contentEditable=!0,h.body.removeAttribute("disabled")):h.designMode="on",a.afterCreate&&a.afterCreate.call(b)}var c,d,e,f,g,h,i,b=this;KEdit.parent.init.call(b,a),b.srcElement=K(a.srcElement),b.div.addClass("ke-edit"),b.designMode=_undef(a.designMode,!0),b.beforeGetHtml=a.beforeGetHtml,b.beforeSetHtml=a.beforeSetHtml,b.afterSetHtml=a.afterSetHtml,c=_undef(a.themesPath,""),d=a.bodyClass,e=a.cssPath,f=a.cssData,g="res:"!=location.protocol&&location.host.replace(/:\d+/,"")!==document.domain,h="document.open();"+(g?'document.domain="'+document.domain+'";':"")+"document.close();",i=_IE?' src="javascript:void(function(){'+encodeURIComponent(h)+'}())"':"",b.iframe=K('<iframe class="ke-edit-iframe" hidefocus="true" frameborder="0"'+i+"></iframe>").css("width","100%"),b.textarea=K('<textarea class="ke-edit-textarea" hidefocus="true"></textarea>').css("width","100%"),b.tabIndex=isNaN(parseInt(a.tabIndex,10))?b.srcElement.attr("tabindex"):parseInt(a.tabIndex,10),b.iframe.attr("tabindex",b.tabIndex),b.textarea.attr("tabindex",b.tabIndex),b.width&&b.setWidth(b.width),b.height&&b.setHeight(b.height),b.designMode?b.textarea.hide():b.iframe.hide(),g&&b.iframe.bind("load",function(){b.iframe.unbind("load"),_IE?j():setTimeout(j,0)}),b.div.append(b.iframe),b.div.append(b.textarea),b.srcElement.hide(),!g&&j()},setWidth:function(a){var b=this;return a=_addUnit(a),b.width=a,b.div.css("width",a),b},setHeight:function(a){var b=this;return a=_addUnit(a),b.height=a,b.div.css("height",a),b.iframe.css("height",a),(_IE&&8>_V||_QUIRKS)&&(a=_addUnit(_removeUnit(a)-2)),b.textarea.css("height",a),b},remove:function(){var a=this,b=a.doc;K(b.body).unbind(),K(b).unbind(),K(a.win).unbind(),a._mousedownHandler&&K(document).unbind("mousedown",a._mousedownHandler),_elementVal(a.srcElement,a.html()),a.srcElement.show(),b.write(""),a.iframe.unbind(),a.textarea.unbind(),KEdit.parent.remove.call(a)},html:function(a,b){var e,c=this,d=c.doc;return c.designMode?(e=d.body,a===undefined?(a=b?"<!doctype html><html>"+e.parentNode.innerHTML+"</html>":e.innerHTML,c.beforeGetHtml&&(a=c.beforeGetHtml(a)),_GECKO&&"<br />"==a&&(a=""),a):(c.beforeSetHtml&&(a=c.beforeSetHtml(a)),_IE&&_V>=9&&(a=a.replace(/(<.*?checked=")checked(".*>)/gi,"$1$2")),K(e).html(a),c.afterSetHtml&&c.afterSetHtml(),c)):a===undefined?c.textarea.val():(c.textarea.val(a),c)},design:function(a){var c,b=this;return(a===undefined?!b.designMode:a)?b.designMode||(c=b.html(),b.designMode=!0,b.html(c),b.textarea.hide(),b.iframe.show()):b.designMode&&(c=b.html(),b.designMode=!1,b.html(c),b.iframe.hide(),b.textarea.show()),b.focus()},focus:function(){var a=this;return a.designMode?a.win.focus():a.textarea[0].focus(),a},blur:function(){var b,a=this;return _IE?(b=K('<input type="text" style="float:left;width:0;height:0;padding:0;margin:0;border:0;" value="" />',a.div),a.div.append(b),b[0].focus(),b.remove()):a.designMode?a.win.blur():a.textarea[0].blur(),a},afterChange:function(a){function e(b){setTimeout(function(){a(b)},1)}var b=this,c=b.doc,d=c.body;return K(c).keyup(function(b){b.ctrlKey||b.altKey||!_CHANGE_KEY_MAP[b.which]||a(b)}),K(c).mouseup(a).contextmenu(a),K(b.win).blur(a),K(d).bind("paste",e),K(d).bind("cut",e),b}}),K.EditClass=KEdit,K.edit=_edit,K.iframeDoc=_iframeDoc,_extend(KToolbar,KWidget,{init:function(a){function c(a){var b=K(a);return b.hasClass("ke-outline")?b:b.hasClass("ke-toolbar-icon")?b.parent():void 0}function d(a,b){var d=c(a.target);if(d){if(d.hasClass("ke-disabled"))return;if(d.hasClass("ke-selected"))return;d[b]("ke-on")}}var b=this;KToolbar.parent.init.call(b,a),b.disableMode=_undef(a.disableMode,!1),b.noDisableItemMap=_toMap(_undef(a.noDisableItems,[])),b._itemMap={},b.div.addClass("ke-toolbar").bind("contextmenu,mousedown,mousemove",function(a){a.preventDefault()}).attr("unselectable","on"),b.div.mouseover(function(a){d(a,"addClass")}).mouseout(function(a){d(a,"removeClass")}).click(function(a){var d=c(a.target);if(d){if(d.hasClass("ke-disabled"))return;b.options.click.call(this,a,d.attr("data-name"))}})},get:function(a){return this._itemMap[a]?this._itemMap[a]:this._itemMap[a]=K("span.ke-icon-"+a,this.div).parent()},select:function(a){return _selectToolbar.call(this,a,function(a){a.addClass("ke-selected")}),self},unselect:function(a){return _selectToolbar.call(this,a,function(a){a.removeClass("ke-selected").removeClass("ke-on")}),self},enable:function(a){var b=this,c=a.get?a:b.get(a);return c&&(c.removeClass("ke-disabled"),c.opacity(1)),b},disable:function(a){var b=this,c=a.get?a:b.get(a);return c&&(c.removeClass("ke-selected").addClass("ke-disabled"),c.opacity(.5)),b},disableAll:function(a,b){var c=this,d=c.noDisableItemMap;return b&&(d=_toMap(b)),(a===undefined?!c.disableMode:a)?(K("span.ke-outline",c.div).each(function(){var a=K(this),b=a[0].getAttribute("data-name",2);d[b]||c.disable(a)}),c.disableMode=!0):(K("span.ke-outline",c.div).each(function(){var a=K(this),b=a[0].getAttribute("data-name",2);d[b]||c.enable(a)}),c.disableMode=!1),c}}),K.ToolbarClass=KToolbar,K.toolbar=_toolbar,_extend(KMenu,KWidget,{init:function(a){var b=this;a.z=a.z||811213,KMenu.parent.init.call(b,a),b.centerLineMode=_undef(a.centerLineMode,!0),b.div.addClass("ke-menu").bind("click,mousedown",function(a){a.stopPropagation()}).attr("unselectable","on")},addItem:function(a){var c,d,e,f,g,h,b=this;return"-"===a.title?(b.div.append(K('<div class="ke-menu-separator"></div>')),void 0):(c=K('<div class="ke-menu-item" unselectable="on"></div>'),d=K('<div class="ke-inline-block ke-menu-item-left"></div>'),e=K('<div class="ke-inline-block ke-menu-item-right"></div>'),f=_addUnit(a.height),g=_undef(a.iconClass,""),b.div.append(c),f&&(c.css("height",f),e.css("line-height",f)),b.centerLineMode&&(h=K('<div class="ke-inline-block ke-menu-item-center"></div>'),f&&h.css("height",f)),c.mouseover(function(){K(this).addClass("ke-menu-item-on"),h&&h.addClass("ke-menu-item-center-on")}).mouseout(function(){K(this).removeClass("ke-menu-item-on"),h&&h.removeClass("ke-menu-item-center-on")}).click(function(b){a.click.call(K(this)),b.stopPropagation()}).append(d),h&&c.append(h),c.append(e),a.checked&&(g="ke-icon-checked"),""!==g&&d.html('<span class="ke-inline-block ke-toolbar-icon ke-toolbar-icon-url '+g+'"></span>'),e.html(a.title),b)},remove:function(){var a=this;return a.options.beforeRemove&&a.options.beforeRemove.call(a),K(".ke-menu-item",a.div[0]).unbind(),KMenu.parent.remove.call(a),a}}),K.MenuClass=KMenu,K.menu=_menu,_extend(KColorPicker,KWidget,{init:function(a){var c,d,e,f,g,h,b=this;for(a.z=a.z||811213,KColorPicker.parent.init.call(b,a),c=a.colors||[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]],b.selectedColor=(a.selectedColor||"").toLowerCase(),b._cells=[],b.div.addClass("ke-colorpicker").bind("click,mousedown",function(a){a.stopPropagation()}).attr("unselectable","on"),d=b.doc.createElement("table"),b.div.append(d),d.className="ke-colorpicker-table",d.cellPadding=0,d.cellSpacing=0,d.border=0,e=d.insertRow(0),f=e.insertCell(0),f.colSpan=c[0].length,b._addAttr(f,"","ke-colorpicker-cell-top"),g=0;g<c.length;g++)for(e=d.insertRow(g+1),h=0;h<c[g].length;h++)f=e.insertCell(h),b._addAttr(f,c[g][h],"ke-colorpicker-cell")},_addAttr:function(a,b,c){var d=this;a=K(a).addClass(c),d.selectedColor===b.toLowerCase()&&a.addClass("ke-colorpicker-cell-selected"),a.attr("title",b||d.options.noColor),a.mouseover(function(){K(this).addClass("ke-colorpicker-cell-on")}),a.mouseout(function(){K(this).removeClass("ke-colorpicker-cell-on")}),a.click(function(a){a.stop(),d.options.click.call(K(this),b)}),b?a.append(K('<div class="ke-colorpicker-cell-color" unselectable="on"></div>').css("background-color",b)):a.html(d.options.noColor),K(a).attr("unselectable","on"),d._cells.push(a)},remove:function(){var a=this;return _each(a._cells,function(){this.unbind()}),KColorPicker.parent.remove.call(a),a}}),K.ColorPickerClass=KColorPicker,K.colorpicker=_colorpicker,_extend(KUploadButton,{init:function(a){var j,k,l,m,n,b=this,c=K(a.button),d=a.fieldName||"file",e=a.url||"",f=c.val(),g=a.extraParams||{},h=c[0].className||"",i=a.target||"kindeditor_upload_iframe_"+(new Date).getTime();a.afterError=a.afterError||function(a){alert(a)},j=[];for(k in g)j.push('<input type="hidden" name="'+k+'" value="'+g[k]+'" />');l=['<div class="ke-inline-block '+h+'">',a.target?"":'<iframe name="'+i+'" style="display:none;"></iframe>',a.form?'<div class="ke-upload-area">':'<form class="ke-upload-area ke-form" method="post" enctype="multipart/form-data" target="'+i+'" action="'+e+'">','<span class="ke-button-common">',j.join(""),'<input type="button" class="ke-button-common ke-button" value="'+f+'" />',"</span>",'<input type="file" class="ke-upload-file" name="'+d+'" tabindex="-1" />',a.form?"</div>":"</form>","</div>"].join(""),m=K(l,c.doc),c.hide(),c.before(m),b.div=m,b.button=c,b.iframe=a.target?K('iframe[name="'+i+'"]'):K("iframe",m),b.form=a.form?K(a.form):K("form",m),b.fileBox=K(".ke-upload-file",m),n=a.width||K(".ke-button-common",m).width(),K(".ke-upload-area",m).width(n),b.options=a},submit:function(){var a=this,b=a.iframe;return b.bind("load",function(){var c,g,d,e,f;b.unbind(),c=document.createElement("form"),a.fileBox.before(c),K(c).append(a.fileBox),c.reset(),K(c).remove(!0),d=K.iframeDoc(b),e=d.getElementsByTagName("pre")[0],f="",f=e?e.innerHTML:d.body.innerHTML,f=_unescape(f),b[0].src="javascript:false";try{g=K.json(f)}catch(h){a.options.afterError.call(a,"<!doctype html><html>"+d.body.parentNode.innerHTML+"</html>")}g&&a.options.afterUpload.call(a,g)}),a.form[0].submit(),a},remove:function(){var a=this;return a.fileBox&&a.fileBox.unbind(),a.iframe.remove(),a.div.remove(),a.button.show(),a}}),K.UploadButtonClass=KUploadButton,K.uploadbutton=_uploadbutton,_extend(KDialog,KWidget,{init:function(a){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,b=this,c=_undef(a.shadowMode,!0);a.z=a.z||811213,a.shadowMode=!1,a.autoScroll=_undef(a.autoScroll,!0),KDialog.parent.init.call(b,a),d=a.title,e=K(a.body,b.doc),f=a.previewBtn,g=a.yesBtn,h=a.noBtn,i=a.closeBtn,j=_undef(a.showMask,!0),b.div.addClass("ke-dialog").bind("click,mousedown",function(a){a.stopPropagation()}),k=K('<div class="ke-dialog-content"></div>').appendTo(b.div),_IE&&7>_V?b.iframeMask=K('<iframe src="about:blank" class="ke-dialog-shadow"></iframe>').appendTo(b.div):c&&K('<div class="ke-dialog-shadow"></div>').appendTo(b.div),l=K('<div class="ke-dialog-header"></div>'),k.append(l),l.html(d),b.closeIcon=K('<span class="ke-dialog-icon-close" title="'+i.name+'"></span>').click(i.click),l.append(b.closeIcon),b.draggable({clickEl:l,beforeDrag:a.beforeDrag}),m=K('<div class="ke-dialog-body"></div>'),k.append(m),m.append(e),n=K('<div class="ke-dialog-footer"></div>'),(f||g||h)&&k.append(n),_each([{btn:f,name:"preview"},{btn:g,name:"yes"},{btn:h,name:"no"}],function(){if(this.btn){var a=_createButton(this.btn);a.addClass("ke-dialog-"+this.name),n.append(a)}}),b.height&&m.height(_removeUnit(b.height)-l.height()-n.height()),b.div.width(b.div.width()),b.div.height(b.div.height()),b.mask=null,j&&(o=_docElement(b.doc),p=Math.max(o.scrollWidth,o.clientWidth),q=Math.max(o.scrollHeight,o.clientHeight),b.mask=_widget({x:0,y:0,z:b.z-1,cls:"ke-dialog-mask",width:p,height:q})),b.autoPos(b.div.width(),b.div.height()),b.footerDiv=n,b.bodyDiv=m,b.headerDiv=l,b.isLoading=!1},setMaskIndex:function(a){var b=this;b.mask.div.css("z-index",a)},showLoading:function(a){a=_undef(a,"");var b=this,c=b.bodyDiv;return b.loading=K('<div class="ke-dialog-loading"><div class="ke-inline-block ke-dialog-loading-content" style="margin-top:'+Math.round(c.height()/3)+'px;">'+a+"</div></div>").width(c.width()).height(c.height()).css("top",b.headerDiv.height()+"px"),c.css("visibility","hidden").after(b.loading),b.isLoading=!0,b},hideLoading:function(){return this.loading&&this.loading.remove(),this.bodyDiv.css("visibility","visible"),this.isLoading=!1,this},remove:function(){var a=this;return a.options.beforeRemove&&a.options.beforeRemove.call(a),a.mask&&a.mask.remove(),a.iframeMask&&a.iframeMask.remove(),a.closeIcon.unbind(),K("input",a.div).unbind(),K("button",a.div).unbind(),a.footerDiv.unbind(),a.bodyDiv.unbind(),a.headerDiv.unbind(),K("iframe",a.div).each(function(){K(this).remove()}),KDialog.parent.remove.call(a),a}}),K.DialogClass=KDialog,K.dialog=_dialog,K.tabs=_tabs,K.loadScript=_loadScript,K.loadStyle=_loadStyle,K.ajax=_ajax,_plugins={},_language={},KEditor.prototype={lang:function(a){return _lang(a,this.langType)},loadPlugin:function(a,b){var c=this;return _plugins[a]?_isFunction(_plugins[a])?(_plugins[a].call(c,KindEditor),b&&b.call(c),c):(setTimeout(function(){c.loadPlugin(a,b)},100),c):(_plugins[a]="loading",_loadScript(c.pluginsPath+a+"/"+a+".js?ver="+encodeURIComponent(K.DEBUG?_TIME:_VERSION),function(){setTimeout(function(){_plugins[a]&&c.loadPlugin(a,b)},0)}),c)},handler:function(a,b){var c=this;return c._handlers[a]||(c._handlers[a]=[]),_isFunction(b)?(c._handlers[a].push(b),c):(_each(c._handlers[a],function(){b=this.call(c,b)}),b)},clickToolbar:function(a,b){var c=this,d="clickToolbar"+a;return b===undefined?c._handlers[d]?c.handler(d):(c.loadPlugin(a,function(){c.handler(d)}),c):c.handler(d,b)},updateState:function(){var a=this;return _each("justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,subscript,superscript,bold,italic,underline,strikethrough".split(","),function(b,c){a.cmd.state(c)?a.toolbar.select(c):a.toolbar.unselect(c)}),a},addContextmenu:function(a){return this._contextmenus.push(a),this},afterCreate:function(a){return this.handler("afterCreate",a)},beforeRemove:function(a){return this.handler("beforeRemove",a)},beforeGetHtml:function(a){return this.handler("beforeGetHtml",a)},beforeSetHtml:function(a){return this.handler("beforeSetHtml",a)},afterSetHtml:function(a){return this.handler("afterSetHtml",a)},create:function(){function m(){return 0===h.height()?(setTimeout(m,100),void 0):(a.resize(c,d,!1),void 0)}var c,d,e,f,g,h,i,j,k,l,a=this,b=a.fullscreenMode;return a.isCreated?a:a.srcElement.data("kindeditor")?a:(a.srcElement.data("kindeditor","true"),_docElement().style.overflow=b?"hidden":"",c=b?_docElement().clientWidth+"px":a.width,d=b?_docElement().clientHeight+"px":a.height,(_IE&&8>_V||_QUIRKS)&&(d=_addUnit(_removeUnit(d)+2)),e=a.container=K(a.layout),b?K(document.body).append(e):a.srcElement.before(e),f=K(".toolbar",e),g=K(".edit",e),h=a.statusbar=K(".statusbar",e),e.removeClass("container").addClass("ke-container ke-container-"+a.themeType).css("width",c),b?(e.css({position:"absolute",left:0,top:0,"z-index":811211}),_GECKO||(a._scrollPos=_getScrollPos()),window.scrollTo(0,0),K(document.body).css({height:"1px",overflow:"hidden"}),K(document.body.parentNode).css("overflow","hidden"),a._fullscreenExecuted=!0):(a._fullscreenExecuted&&(K(document.body).css({height:"",overflow:""}),K(document.body.parentNode).css("overflow","")),a._scrollPos&&window.scrollTo(a._scrollPos.x,a._scrollPos.y)),i=[],K.each(a.items,function(b,c){"|"==c?i.push('<span class="ke-inline-block ke-separator"></span>'):"/"==c?i.push('<div class="ke-hr"></div>'):(i.push('<span class="ke-outline" data-name="'+c+'" title="'+a.lang(c)+'" unselectable="on">'),i.push('<span class="ke-toolbar-icon ke-toolbar-icon-url ke-icon-'+c+'" unselectable="on"></span></span>'))}),j=a.toolbar=_toolbar({src:f,html:i.join(""),noDisableItems:a.noDisableItems,click:function(b,c){if(b.stop(),a.menu){var d=a.menu.name;if(a.hideMenu(),d===c)return}a.clickToolbar(c)}}),k=_removeUnit(d)-j.div.height(),l=a.edit=_edit({height:k>0&&_removeUnit(d)>a.minHeight?k:a.minHeight,src:g,srcElement:a.srcElement,designMode:a.designMode,themesPath:a.themesPath,bodyClass:a.bodyClass,cssPath:a.cssPath,cssData:a.cssData,beforeGetHtml:function(b){return b=a.beforeGetHtml(b),b=_removeBookmarkTag(_removeTempTag(b)),_formatHtml(b,a.filterMode?a.htmlTags:null,a.urlType,a.wellFormatMode,a.indentChar)},beforeSetHtml:function(b){return b=_formatHtml(b,a.filterMode?a.htmlTags:null,"",!1),a.beforeSetHtml(b)},afterSetHtml:function(){a.edit=l=this,a.afterSetHtml()},afterCreate:function(){if(a.edit=l=this,a.cmd=l.cmd,a._docMousedownFn=function(){a.menu&&a.hideMenu()},K(l.doc,document).mousedown(a._docMousedownFn),_bindContextmenuEvent.call(a),_bindNewlineEvent.call(a),_bindTabEvent.call(a),_bindFocusEvent.call(a),l.afterChange(function(){l.designMode&&(a.updateState(),a.addBookmark(),a.options.afterChange&&a.options.afterChange.call(a))}),l.textarea.keyup(function(b){b.ctrlKey||b.altKey||!_INPUT_KEY_MAP[b.which]||a.options.afterChange&&a.options.afterChange.call(a)}),a.readonlyMode&&a.readonly(),a.isCreated=!0,""===a.initContent&&(a.initContent=a.html()),a._undoStack.length>0){var b=a._undoStack.pop();b.start&&(a.html(b.html),l.cmd.range.moveToBookmark(b),a.select())}a.afterCreate(),a.options.afterCreate&&a.options.afterCreate.call(a)}}),h.removeClass("statusbar").addClass("ke-statusbar").append('<span class="ke-inline-block ke-statusbar-center-icon"></span>').append('<span class="ke-inline-block ke-statusbar-right-icon"></span>'),a._fullscreenResizeHandler&&(K(window).unbind("resize",a._fullscreenResizeHandler),a._fullscreenResizeHandler=null),m(),b?(a._fullscreenResizeHandler=function(){a.isCreated&&a.resize(_docElement().clientWidth,_docElement().clientHeight,!1)},K(window).bind("resize",a._fullscreenResizeHandler),j.select("fullscreen"),h.first().css("visibility","hidden"),h.last().css("visibility","hidden")):(_GECKO&&K(window).bind("scroll",function(){a._scrollPos=_getScrollPos()}),a.resizeType>0?_drag({moveEl:e,clickEl:h,moveFn:function(b,c,d,e,f,g){e+=g,a.resize(null,e)}}):h.first().css("visibility","hidden"),2===a.resizeType?_drag({moveEl:e,clickEl:h.last(),moveFn:function(b,c,d,e,f,g){d+=f,e+=g,a.resize(d,e)}}):h.last().css("visibility","hidden")),a)},remove:function(){var a=this;return a.isCreated?(a.beforeRemove(),a.srcElement.data("kindeditor",""),a.menu&&a.hideMenu(),_each(a.dialogs,function(){a.hideDialog()}),K(document).unbind("mousedown",a._docMousedownFn),a.toolbar.remove(),a.edit.remove(),a.statusbar.last().unbind(),a.statusbar.unbind(),a.container.remove(),a.container=a.toolbar=a.edit=a.menu=null,a.dialogs=[],a.isCreated=!1,a):a},resize:function(a,b,c){var e,d=this;return c=_undef(c,!0),a&&(/%/.test(a)||(a=_removeUnit(a),a=a<d.minWidth?d.minWidth:a),d.container.css("width",_addUnit(a)),c&&(d.width=_addUnit(a))),b&&(b=_removeUnit(b),e=_removeUnit(b)-d.toolbar.div.height()-d.statusbar.height(),e=e<d.minHeight?d.minHeight:e,d.edit.setHeight(e),c&&(d.height=_addUnit(b))),d},select:function(){return this.isCreated&&this.cmd.select(),this},html:function(a){var b=this;return a===undefined?b.isCreated?b.edit.html():_elementVal(b.srcElement):(b.isCreated?b.edit.html(a):_elementVal(b.srcElement,a),b.isCreated&&b.cmd.selection(),b)},fullHtml:function(){return this.isCreated?this.edit.html(undefined,!0):""},text:function(a){var b=this;return a===undefined?_trim(b.html().replace(/<(?!img|embed).*?>/gi,"").replace(/&nbsp;/gi," ")):b.html(_escape(a))},isEmpty:function(){return""===_trim(this.text().replace(/\r\n|\n|\r/,""))},isDirty:function(){return _trim(this.initContent.replace(/\r\n|\n|\r|t/g,""))!==_trim(this.html().replace(/\r\n|\n|\r|t/g,""))},selectedHtml:function(){var a=this.isCreated?this.cmd.range.html():"";return a=_removeBookmarkTag(_removeTempTag(a))},count:function(a){var b=this;return a=(a||"html").toLowerCase(),"html"===a?b.html().length:"text"===a?b.text().replace(/<(?:img|embed).*?>/gi,"K").replace(/\r\n|\n|\r/g,"").length:0},exec:function(a){a=a.toLowerCase();var b=this,c=b.cmd,d=_inArray(a,"selectall,copy,paste,print".split(","))<0;return d&&b.addBookmark(!1),c[a].apply(c,_toArray(arguments,1)),d&&(b.updateState(),b.addBookmark(!1),b.options.afterChange&&b.options.afterChange.call(b)),b},insertHtml:function(a,b){return this.isCreated?(a=this.beforeSetHtml(a),this.exec("inserthtml",a,b),this):this},appendHtml:function(a){if(this.html(this.html()+a),this.isCreated){var b=this.cmd;b.range.selectNodeContents(b.doc.body).collapse(!1),b.select()}return this},sync:function(){return _elementVal(this.srcElement,this.html()),this},focus:function(){return this.isCreated?this.edit.focus():this.srcElement[0].focus(),this},blur:function(){return this.isCreated?this.edit.blur():this.srcElement[0].blur(),this},addBookmark:function(a){var f,b,c,d,e,g,h;return a=_undef(a,!0),b=this,c=b.edit,d=c.doc.body,e=_removeTempTag(d.innerHTML),a&&b._undoStack.length>0&&(g=b._undoStack[b._undoStack.length-1],Math.abs(e.length-_removeBookmarkTag(g.html).length)<b.minChangeSize)?b:(c.designMode&&!b._firstAddBookmark?(h=b.cmd.range,f=h.createBookmark(!0),f.html=_removeTempTag(d.innerHTML),h.moveToBookmark(f)):f={html:e},b._firstAddBookmark=!1,_addBookmarkToStack(b._undoStack,f),b)},undo:function(){return _undoToRedo.call(this,this._undoStack,this._redoStack)},redo:function(){return _undoToRedo.call(this,this._redoStack,this._undoStack)},fullscreen:function(a){return this.fullscreenMode=a===undefined?!this.fullscreenMode:a,this.addBookmark(!1),this.remove().create()},readonly:function(a){a=_undef(a,!0);var b=this,c=b.edit,d=c.doc;b.designMode?b.toolbar.disableAll(a,[]):_each(b.noDisableItems,function(){b.toolbar[a?"disable":"enable"](this)}),_IE?d.body.contentEditable=!a:d.designMode=a?"off":"on",c.textarea[0].disabled=a},createMenu:function(a){var b=this,c=a.name,d=b.toolbar.get(c),e=d.pos();return a.x=e.x,a.y=e.y+d.height(),a.z=b.options.zIndex,a.shadowMode=_undef(a.shadowMode,b.shadowMode),a.selectedColor!==undefined?(a.cls="ke-colorpicker-"+b.themeType,a.noColor=b.lang("noColor"),b.menu=_colorpicker(a)):(a.cls="ke-menu-"+b.themeType,a.centerLineMode=!1,b.menu=_menu(a)),b.menu},hideMenu:function(){return this.menu.remove(),this.menu=null,this},hideContextmenu:function(){return this.contextmenu.remove(),this.contextmenu=null,this},createDialog:function(a){var d,e,f,b=this;return a.name,a.z=b.options.zIndex,a.shadowMode=_undef(a.shadowMode,b.shadowMode),a.closeBtn=_undef(a.closeBtn,{name:b.lang("close"),click:function(){b.hideDialog(),_IE&&b.cmd&&b.cmd.select()}}),a.noBtn=_undef(a.noBtn,{name:b.lang(a.yesBtn?"no":"close"),click:function(){b.hideDialog(),_IE&&b.cmd&&b.cmd.select()}}),"page"!=b.dialogAlignType&&(a.alignEl=b.container),a.cls="ke-dialog-"+b.themeType,b.dialogs.length>0&&(d=b.dialogs[0],e=b.dialogs[b.dialogs.length-1],d.setMaskIndex(e.z+2),a.z=e.z+3,a.showMask=!1),f=_dialog(a),b.dialogs.push(f),f},hideDialog:function(){var b,c,a=this;return a.dialogs.length>0&&a.dialogs.pop().remove(),a.dialogs.length>0&&(b=a.dialogs[0],c=a.dialogs[a.dialogs.length-1],b.setMaskIndex(c.z-1)),a},errorDialog:function(a){var b=this,c=b.createDialog({width:750,title:b.lang("uploadError"),body:'<div style="padding:10px 20px;"><iframe frameborder="0" style="width:708px;height:400px;"></iframe></div>'}),d=K("iframe",c.div),e=K.iframeDoc(d);return e.open(),e.write(a),e.close(),K(e.body).css("background-color","#FFF"),d[0].contentWindow.focus(),b}},_instances=[],K.remove=function(a){_eachEditor(a,function(a){this.remove(),_instances.splice(a,1)})},K.sync=function(a){_eachEditor(a,function(){this.sync()})},K.html=function(a,b){_eachEditor(a,function(){this.html(b)})},K.insertHtml=function(a,b){_eachEditor(a,function(){this.insertHtml(b)})},K.appendHtml=function(a,b){_eachEditor(a,function(){this.appendHtml(b)})},_IE&&7>_V&&_nativeCommand(document,"BackgroundImageCache",!0),K.EditorClass=KEditor,K.editor=_editor,K.create=_create,K.instances=_instances,K.plugin=_plugin,K.lang=_lang,_plugin("core",function(a){var d,b=this,c={undo:"Z",redo:"Y",bold:"B",italic:"I",underline:"U",print:"P",selectall:"A"};b.afterSetHtml(function(){b.options.afterChange&&b.options.afterChange.call(b)}),b.afterCreate(function(){var c,d,e;if("form"==b.syncType){for(c=a(b.srcElement),d=!1;c=c.parent();)if("form"==c.name){d=!0;break}d&&(c.bind("submit",function(){b.sync(),a(window).bind("unload",function(){b.edit.textarea.remove()})}),e=a('[type="reset"]',c),e.click(function(){b.html(b.initContent),b.cmd.selection()}),b.beforeRemove(function(){c.unbind(),e.unbind()}))}}),b.clickToolbar("source",function(){b.edit.designMode?(b.toolbar.disableAll(!0),b.edit.design(!1),b.toolbar.select("source")):(b.toolbar.disableAll(!1),b.edit.design(!0),b.toolbar.unselect("source"),_GECKO?setTimeout(function(){b.cmd.selection()},0):b.cmd.selection()),b.designMode=b.edit.designMode}),b.afterCreate(function(){b.designMode||b.toolbar.disableAll(!0).select("source")}),b.clickToolbar("fullscreen",function(){b.fullscreen()}),b.fullscreenShortcut&&(d=!1,b.afterCreate(function(){if(a(b.edit.doc,b.edit.textarea).keyup(function(a){27==a.which&&setTimeout(function(){b.fullscreen()},0)}),d){if(_IE&&!b.designMode)return;b.focus()}d||(d=!0)})),_each("undo,redo".split(","),function(a,d){c[d]&&b.afterCreate(function(){_ctrl(this.edit.doc,c[d],function(){b.clickToolbar(d)})}),b.clickToolbar(d,function(){b[d]()})}),b.clickToolbar("formatblock",function(){var a=b.lang("formatblock.formatBlock"),c={h1:28,h2:24,h3:18,H4:14,p:12},d=b.cmd.val("formatblock"),e=b.createMenu({name:"formatblock",width:"en"==b.langType?200:150});_each(a,function(a,f){var g="font-size:"+c[a]+"px;";"h"===a.charAt(0)&&(g+="font-weight:bold;"),e.addItem({title:'<span style="'+g+'" unselectable="on">'+f+"</span>",height:c[a]+12,checked:d===a||d===f,click:function(){b.select().exec("formatblock","<"+a+">").hideMenu()}})})}),b.clickToolbar("fontname",function(){var a=b.cmd.val("fontname"),c=b.createMenu({name:"fontname",width:150});_each(b.lang("fontname.fontName"),function(d,e){c.addItem({title:'<span style="font-family: '+d+';" unselectable="on">'+e+"</span>",checked:a===d.toLowerCase()||a===e.toLowerCase(),click:function(){b.exec("fontname",d).hideMenu()}})})}),b.clickToolbar("fontsize",function(){var a=b.cmd.val("fontsize"),c=b.createMenu({name:"fontsize",width:150});_each(b.fontSizeTable,function(d,e){c.addItem({title:'<span style="font-size:'+e+';" unselectable="on">'+e+"</span>",height:_removeUnit(e)+12,checked:a===e,click:function(){b.exec("fontsize",e).hideMenu()}})})}),_each("forecolor,hilitecolor".split(","),function(a,c){b.clickToolbar(c,function(){b.createMenu({name:c,selectedColor:b.cmd.val(c)||"default",colors:b.colorTable,click:function(a){b.exec(c,a).hideMenu()}})})}),_each("cut,copy,paste".split(","),function(a,c){b.clickToolbar(c,function(){b.focus();try{b.exec(c,null)}catch(a){alert(b.lang(c+"Error"))}})}),b.clickToolbar("about",function(){var a='<div style="margin:20px;"><div>KindEditor '+_VERSION+"</div>"+'<div>Copyright &copy; <a href="http://www.kindsoft.net/" target="_blank">kindsoft.net</a> All rights reserved.</div>'+"</div>";b.createDialog({name:"about",width:350,title:b.lang("about"),body:a})}),b.plugin.getSelectedLink=function(){return b.cmd.commonAncestor("a")},b.plugin.getSelectedImage=function(){return _getImageFromRange(b.edit.cmd.range,function(a){return!/^ke-\w+$/i.test(a[0].className)})},b.plugin.getSelectedFlash=function(){return _getImageFromRange(b.edit.cmd.range,function(a){return"ke-flash"==a[0].className})},b.plugin.getSelectedMedia=function(){return _getImageFromRange(b.edit.cmd.range,function(a){return"ke-media"==a[0].className||"ke-rm"==a[0].className})},b.plugin.getSelectedAnchor=function(){return _getImageFromRange(b.edit.cmd.range,function(a){return"ke-anchor"==a[0].className})},_each("link,image,flash,media,anchor".split(","),function(a,c){var d=c.charAt(0).toUpperCase()+c.substr(1);_each("edit,delete".split(","),function(a,e){b.addContextmenu({title:b.lang(e+d),click:function(){b.loadPlugin(c,function(){b.plugin[c][e](),b.hideMenu()})},cond:b.plugin["getSelected"+d],width:150,iconClass:"edit"==e?"ke-icon-"+c:undefined})}),b.addContextmenu({title:"-"})}),b.plugin.getSelectedTable=function(){return b.cmd.commonAncestor("table")},b.plugin.getSelectedRow=function(){return b.cmd.commonAncestor("tr")},b.plugin.getSelectedCell=function(){return b.cmd.commonAncestor("td")},_each("prop,cellprop,colinsertleft,colinsertright,rowinsertabove,rowinsertbelow,rowmerge,colmerge,rowsplit,colsplit,coldelete,rowdelete,insert,delete".split(","),function(a,c){var d=_inArray(c,["prop","delete"])<0?b.plugin.getSelectedCell:b.plugin.getSelectedTable;
    b.addContextmenu({title:b.lang("table"+c),click:function(){b.loadPlugin("table",function(){b.plugin.table[c](),b.hideMenu()})},cond:d,width:170,iconClass:"ke-icon-table"+c})}),b.addContextmenu({title:"-"}),_each("selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,indent,outdent,subscript,superscript,hr,print,bold,italic,underline,strikethrough,removeformat,unlink".split(","),function(a,d){c[d]&&b.afterCreate(function(){_ctrl(this.edit.doc,c[d],function(){b.cmd.selection(),b.clickToolbar(d)})}),b.clickToolbar(d,function(){b.focus().exec(d,null)})}),b.afterCreate(function(){function i(){d.range.moveToBookmark(e),d.select(),_WEBKIT&&(a("div."+g,f).each(function(){a(this).after("<br />").remove(!0)}),a("span.Apple-style-span",f).remove(!0),a("span.Apple-tab-span",f).remove(!0),a("span[style]",f).each(function(){"nowrap"==a(this).css("white-space")&&a(this).remove(!0)}),a("meta",f).remove());var c=f[0].innerHTML;f.remove(),""!==c&&(_WEBKIT&&(c=c.replace(/(<br>)\1/gi,"$1")),2===b.pasteType&&(c=c.replace(/(<(?:p|p\s[^>]*)>) *(<\/p>)/gi,""),/schemas-microsoft-com|worddocument|mso-\w+/i.test(c)?c=_clearMsWord(c,b.filterMode?b.htmlTags:a.options.htmlTags):(c=_formatHtml(c,b.filterMode?b.htmlTags:null),c=b.beforeSetHtml(c))),1===b.pasteType&&(c=c.replace(/&nbsp;/gi," "),c=c.replace(/\n\s*\n/g,"\n"),c=c.replace(/<br[^>]*>/gi,"\n"),c=c.replace(/<\/p><p[^>]*>/gi,"\n"),c=c.replace(/<[^>]+>/g,""),c=c.replace(/ {2}/g," &nbsp;"),"p"==b.newlineTag?/\n/.test(c)&&(c=c.replace(/^/,"<p>").replace(/$/,"<br /></p>").replace(/\n/g,"<br /></p><p>")):c=c.replace(/\n/g,"<br />$&")),b.insertHtml(c,!0))}var d,e,f,c=b.edit.doc,g="__kindeditor_paste__",h=!1;a(c.body).bind("paste",function(j){if(0===b.pasteType)return j.stop(),void 0;if(!h){if(h=!0,a("div."+g,c).remove(),d=b.cmd.selection(),e=d.range.createBookmark(),f=a('<div class="'+g+'"></div>',c).css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",left:"-1981px",top:a(e.start).pos().y+"px","white-space":"nowrap"}),a(c.body).append(f),_IE){var k=d.range.get(!0);k.moveToElementText(f[0]),k.select(),k.execCommand("paste"),j.preventDefault()}else d.range.selectNodeContents(f[0]),d.select();setTimeout(function(){i(),h=!1},0)}})}),b.beforeGetHtml(function(a){return _IE&&8>=_V&&(a=a.replace(/<div\s+[^>]*data-ke-input-tag="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(a,b){return unescape(b)}),a=a.replace(/(<input)((?:\s+[^>]*)?>)/gi,function(a,b,c){return/\s+type="[^"]+"/i.test(a)?a:b+' type="text"'+c})),a.replace(/(<(?:noscript|noscript\s[^>]*)>)([\s\S]*?)(<\/noscript>)/gi,function(a,b,c,d){return b+_unescape(c).replace(/\s+/g," ")+d}).replace(/<img[^>]*class="?ke-(flash|rm|media)"?[^>]*>/gi,function(a){var b=_getAttrList(a),c=_getCssList(b.style||""),d=_mediaAttrs(b["data-ke-tag"]),e=_undef(c.width,""),f=_undef(c.height,"");return/px/i.test(e)&&(e=_removeUnit(e)),/px/i.test(f)&&(f=_removeUnit(f)),d.width=_undef(b.width,e),d.height=_undef(b.height,f),_mediaEmbed(d)}).replace(/<img[^>]*class="?ke-anchor"?[^>]*>/gi,function(a){var b=_getAttrList(a);return'<a name="'+unescape(b["data-ke-name"])+'"></a>'}).replace(/<div\s+[^>]*data-ke-script-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(a,b,c){return"<script"+unescape(b)+">"+unescape(c)+"</script>"}).replace(/<div\s+[^>]*data-ke-noscript-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(a,b,c){return"<noscript"+unescape(b)+">"+unescape(c)+"</noscript>"}).replace(/(<[^>]*)data-ke-src="([^"]*)"([^>]*>)/gi,function(a,b,c){return a=a.replace(/(\s+(?:href|src)=")[^"]*(")/i,function(a,b,d){return b+_unescape(c)+d}),a=a.replace(/\s+data-ke-src="[^"]*"/i,"")}).replace(/(<[^>]+\s)data-ke-(on\w+="[^"]*"[^>]*>)/gi,function(a,b,c){return b+c})}),b.beforeSetHtml(function(a){return _IE&&8>=_V&&(a=a.replace(/<input[^>]*>|<(select|button)[^>]*>[\s\S]*?<\/\1>/gi,function(a){var b=_getAttrList(a),c=_getCssList(b.style||"");return"none"==c.display?'<div class="ke-display-none" data-ke-input-tag="'+escape(a)+'"></div>':a})),a.replace(/<embed[^>]*type="([^"]+)"[^>]*>(?:<\/embed>)?/gi,function(a){var c=_getAttrList(a);return c.src=_undef(c.src,""),c.width=_undef(c.width,0),c.height=_undef(c.height,0),_mediaImg(b.themesPath+"common/blank.gif",c)}).replace(/<a[^>]*name="([^"]+)"[^>]*>(?:<\/a>)?/gi,function(a){var c=_getAttrList(a);return c.href!==undefined?a:'<img class="ke-anchor" src="'+b.themesPath+'common/anchor.gif" data-ke-name="'+escape(c.name)+'" />'}).replace(/<script([^>]*)>([\s\S]*?)<\/script>/gi,function(a,b,c){return'<div class="ke-script" data-ke-script-attr="'+escape(b)+'">'+escape(c)+"</div>"}).replace(/<noscript([^>]*)>([\s\S]*?)<\/noscript>/gi,function(a,b,c){return'<div class="ke-noscript" data-ke-noscript-attr="'+escape(b)+'">'+escape(c)+"</div>"}).replace(/(<[^>]*)(href|src)="([^"]*)"([^>]*>)/gi,function(a,b,c,d,e){return a.match(/\sdata-ke-src="[^"]*"/i)?a:a=b+c+'="'+d+'"'+' data-ke-src="'+_escape(d)+'"'+e}).replace(/(<[^>]+\s)(on\w+="[^"]*"[^>]*>)/gi,function(a,b,c){return b+"data-ke-"+c}).replace(/<table[^>]*\s+border="0"[^>]*>/gi,function(a){return a.indexOf("ke-zeroborder")>=0?a:_addClassToTag(a,"ke-zeroborder")})})}))}(window);